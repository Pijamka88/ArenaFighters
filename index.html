<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="telegram:web_app_version" content="1.0">
    <title>Chaos Arena</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap');
        
        body {
            margin: 0;
            padding: 20px;
            background: #1a1a1a;
            color: #f0d9b5;
            font-family: 'MedievalSharp', cursive;
            text-align: center;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .menu, .game-screen, .upgrade-screen, .lose-screen {
            display: none;
        }

        .visible {
            display: block;
        }

        button {
            background: #5a3624;
            border: 2px solid #a0522d;
            color: #f0d9b5;
            padding: 15px 30px;
            margin: 10px;
            font-size: 1.2em;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
        }

        button:hover {
            background: #7c4c33;
        }

        .status {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
        }

        .health-bar {
            width: 200px;
            height: 20px;
            background: #444;
            border: 2px solid #666;
            margin: 10px auto;
        }

        .health {
            height: 100%;
            background: #ff4444;
            transition: width 0.5s;
        }

        .character {
            font-size: 4em;
            margin: 20px;
        }

        .damage-text {
            position: absolute;
            color: #ff4444;
            font-size: 2em;
            text-shadow: 2px 2px 4px #000;
            animation: floatUp 1s forwards;
        }

        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-50px); opacity: 0; }
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div class="container">
        <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
        <div class="menu visible">
            <h1>CHAOS ARENA</h1>
            <div class="status">
                <div>
                    <div> level: <span id="menu-level">1</span></div>
                    <div> attack: <span id="menu-attack">10</span></div>
                    <div> armor: <span id="menu-armor">5</span></div>
                </div>
                <div>
                    <div> health: <span id="menu-health">100</span></div>
                    <div> points: <span id="menu-points">0</span></div>
                </div>
            </div>
            <button onclick="startBattle()">–ù–ê–ß–ê–¢–¨ –ë–û–ô</button>
            <button onclick="showUpgrades()">–ü–†–û–ö–ê–ß–ö–ê</button>
            <button onclick="exitGame()">–í–´–•–û–î</button>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –±–æ—è -->
        <div class="game-screen">
            <div class="status">
                <div>
                    <span id="player-level">1</span> lvl
                    <div class="health-bar">
                        <div id="player-health-bar" class="health" style="width:100%"></div>
                    </div>
                </div>
                <div>
                    <span id="enemy-level">1</span> lvl
                    <div class="health-bar">
                        <div id="enemy-health-bar" class="health" style="width:100%"></div>
                    </div>
                </div>
            </div>
            
            <div class="battle-field">
                <div class="character" id="player-sprite">‚öîÔ∏è</div>
                <div class="character" id="enemy-sprite">üî•</div>
            </div>
            
            <div id="damage-display"></div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –ø—Ä–æ–∫–∞—á–∫–∏ -->
        <div class="upgrade-screen">
            <h2>–í—ã–±–µ—Ä–∏—Ç–µ —É–ª—É—á—à–µ–Ω–∏–µ:</h2>
            <button onclick="upgrade('attack')">–ê—Ç–∞–∫–∞ (+5)</button>
            <button onclick="upgrade('health')">–ó–¥–æ—Ä–æ–≤—å–µ (+20)</button>
            <button onclick="upgrade('armor')">–ë—Ä–æ–Ω—è (+3)</button>
            <button onclick="showMenu()">–ù–∞–∑–∞–¥</button>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –ø—Ä–æ–∏–≥—Ä—ã—à–∞ -->
        <div class="lose-screen">
            <h1>–ò–ì–†–û–ö –ü–†–û–ò–ì–†–ê–õ!</h1>
            <button onclick="showMenu()">–í –º–µ–Ω—é</button>
        </div>
    </div>

    <script>
        let player = {
            level: 1,
            xp: 0,
            xpNeeded: 100,
            health: 100,
            maxHealth: 100,
            attack: 10,
            armor: 5,
            skillPoints: 0
        };

        let enemy = {
            level: 1,
            health: 100,
            maxHealth: 100,
            attack: 8
        };

        let battleInterval;
        let damageQueue = [];

        function loadGame() {
            const saved = localStorage.getItem('chaosArenaSave');
            if (saved) {
                Object.assign(player, JSON.parse(saved));
            }
            updateMenuStats();
        }

        function saveGame() {
            localStorage.setItem('chaosArenaSave', JSON.stringify(player));
        }

        function showMenu() {
            document.querySelector('.menu').classList.add('visible');
            document.querySelector('.game-screen').classList.remove('visible');
            document.querySelector('.upgrade-screen').classList.remove('visible');
            document.querySelector('.lose-screen').classList.remove('visible');
            updateMenuStats();
        }

        function updateMenuStats() {
            document.getElementById('menu-level').textContent = player.level;
            document.getElementById('menu-attack').textContent = player.attack;
            document.getElementById('menu-armor').textContent = player.armor;
            document.getElementById('menu-health').textContent = player.maxHealth;
            document.getElementById('menu-points').textContent = player.skillPoints;
        }

        function startBattle() {
            document.querySelector('.menu').classList.remove('visible');
            document.querySelector('.game-screen').classList.add('visible');

            enemy.level = player.level + Math.floor(Math.random() * 3) - 1;
            enemy.level = Math.max(1, enemy.level);
            enemy.maxHealth = 100 + (enemy.level - 1) * 20;
            enemy.health = enemy.maxHealth;
            enemy.attack = 8 + (enemy.level - 1) * 3;

            updateBattleStats();
            battleInterval = setInterval(battleTurn, 2000);
        }

        function updateBattleStats() {
            document.getElementById('player-level').textContent = player.level;
            document.getElementById('player-health-bar').style.width = (player.health / player.maxHealth) * 100 + '%';
            
            document.getElementById('enemy-level').textContent = enemy.level;
            document.getElementById('enemy-health-bar').style.width = (enemy.health / enemy.maxHealth) * 100 + '%';
        }

        function battleTurn() {
            if (player.health <= 0 || enemy.health <= 0) return;

            // –ê—Ç–∞–∫–∞ –∏–≥—Ä–æ–∫–∞
            let damage = Math.max(1, player.attack - enemy.armor);
            enemy.health -= damage;
            showDamage(damage, 'enemy');
            updateBattleStats();

            if (enemy.health <= 0) {
                endBattle(true);
                return;
            }

            // –ê—Ç–∞–∫–∞ –≤—Ä–∞–≥–∞
            setTimeout(() => {
                damage = Math.max(1, enemy.attack - player.armor);
                player.health -= damage;
                showDamage(damage, 'player');
                updateBattleStats();

                if (player.health <= 0) {
                    endBattle(false);
                }
            }, 1000);
        }

        function showDamage(amount, target) {
            const display = document.getElementById('damage-display');
            const text = document.createElement('div');
            text.className = 'damage-text';
            text.textContent = `-${amount}`;
            text.style.left = target === 'player' ? '20%' : '70%';
            display.appendChild(text);
            setTimeout(() => text.remove(), 1000);
        }

        function endBattle(victory) {
            clearInterval(battleInterval);
            
            if (victory) {
                const xpGained = 50 + enemy.level * 20;
                player.xp += xpGained;
                while (player.xp >= player.xpNeeded) {
                    player.level++;
                    player.skillPoints++;
                    player.xp -= player.xpNeeded;
                    player.xpNeeded = Math.floor(player.xpNeeded * 1.5);
                }
                saveGame();
                showVictoryScreen();
            } else {
                document.querySelector('.game-screen').classList.remove('visible');
                document.querySelector('.lose-screen').classList.add('visible');
                player.health = player.maxHealth;
                saveGame();
            }
        }

        function showVictoryScreen() {
            alert(`–ü–æ–±–µ–¥–∞! –ü–æ–ª—É—á–µ–Ω–æ –æ–ø—ã—Ç–∞: ${xpGained}`);
            if (player.skillPoints > 0) {
                showUpgrades();
            } else {
                showMenu();
            }
        }

        function showUpgrades() {
            document.querySelector('.game-screen').classList.remove('visible');
            document.querySelector('.upgrade-screen').classList.add('visible');
        }

        function upgrade(stat) {
            if (player.skillPoints <= 0) return;

            player.skillPoints--;
            switch(stat) {
                case 'attack':
                    player.attack += 5;
                    break;
                case 'health':
                    player.maxHealth += 20;
                    player.health = player.maxHealth;
                    break;
                case 'armor':
                    player.armor += 3;
                    break;
            }
            saveGame();
            updateMenuStats();
            if (player.skillPoints === 0) showMenu();
        }

        function exitGame() {
            if (confirm('–í—ã–π—Ç–∏ –∏–∑ –∏–≥—Ä—ã? –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è.')) {
                window.close();
            }
        }

        loadGame();
        showMenu();
    </script>
</body>
</html>
