<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chaos Arena</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #1a1a1a;
            color: #f0e6d2;
            font-family: 'Courier New', Courier, monospace;
        }

        .menu {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            text-align: center;
        }

        .menu button {
            background: #4a3a2f;
            border: 2px solid #6b4e3d;
            padding: 15px 30px;
            margin: 10px;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s;
        }

        .menu button:hover {
            background: #6b4e3d;
        }

        .game-container {
            display: none;
            flex-direction: column;
            height: 100vh;
        }

        .battle-screen {
            flex: 1;
            display: flex;
            justify-content: space-around;
            align-items: flex-start;
            padding: 20px;
        }

        .character {
            position: relative;
            width: 150px;
            text-align: center;
        }

        .health-bar {
            background: #444;
            width: 100%;
            height: 20px;
            border: 2px solid #666;
            margin: 10px 0;
        }

        .health-fill {
            background: #f00;
            height: 100%;
            transition: width 0.5s;
        }

        .damage-text {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2em;
            color: #ff4444;
            opacity: 0;
            animation: damageAnim 1s forwards;
        }

        @keyframes damageAnim {
            0% { opacity: 1; transform: translateX(-50%) translateY(0); }
            100% { opacity: 0; transform: translateX(-50%) translateY(-50px); }
        }

        .level-up-screen {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }

        .stat-button {
            background: #2d4263;
            border: 2px solid #4b6d9e;
            padding: 10px 20px;
            margin: 10px;
            font-size: 1em;
            cursor: pointer;
        }

        .game-over {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            color: #ff0000;
            font-size: 3em;
            text-align: center;
            padding-top: 20vh;
        }

        .player {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path fill="#a0a0a0" d="M50 10L60 20H40zM50 30L60 40H40zM50 50L60 60H40zM50 70L60 80H40zM50 90L60 100H40z"/></svg>');
            background-size: cover;
            height: 150px;
        }

        .enemy {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path fill="#c44" d="M50 10L70 30H30zM50 40L70 60H30zM50 70L70 90H30z"/></svg>');
            background-size: cover;
            height: 150px;
        }
    </style>
</head>
<body>
    <div class="menu" id="mainMenu">
        <h1>Chaos Arena</h1>
        <button onclick="startNewGame()">Новая игра</button>
        <button onclick="continueGame()" id="continueButton" disabled>Продолжить</button>
    </div>

    <div class="game-container" id="gameContainer">
        <div class="battle-screen" id="battleScreen">
            <div class="character player" id="player">
                <div class="health-bar">
                    <div class="health-fill" id="playerHealth"></div>
                </div>
                <div>Уровень: <span id="playerLevel">1</span></div>
            </div>
            <div class="character enemy" id="enemy">
                <div class="health-bar">
                    <div class="health-fill" id="enemyHealth"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="level-up-screen" id="levelUpScreen">
        <h2>Уровень повышен!</h2>
        <div>Очков улучшения: <span id="upgradePoints">1</span></div>
        <button class="stat-button" onclick="upgradeStat('attack')">Атака</button>
        <button class="stat-button" onclick="upgradeStat('armor')">Броня</button>
        <button class="stat-button" onclick="upgradeStat('maxHealth')">Жизнь</button>
    </div>

    <div class="game-over" id="gameOverScreen">
        <div>Игрок проиграл!</div>
        <button onclick="showMainMenu()">В главное меню</button>
    </div>

    <script>
        let player = {
            level: 1,
            xp: 0,
            xpRequired: 100,
            attack: 10,
            armor: 5,
            maxHealth: 100,
            currentHealth: 100,
            upgradePoints: 0
        };

        let enemy = {
            level: 1,
            attack: 8,
            armor: 3,
            maxHealth: 80,
            currentHealth: 80
        };

        let gameInterval;
        let isPlayerTurn = true;

        function startNewGame() {
            resetGame();
            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('gameContainer').style.display = 'flex';
            startBattle();
        }

        function continueGame() {
            loadGame();
            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('gameContainer').style.display = 'flex';
            startBattle();
        }

        function resetGame() {
            player = {
                level: 1,
                xp: 0,
                xpRequired: 100,
                attack: 10,
                armor: 5,
                maxHealth: 100,
                currentHealth: 100,
                upgradePoints: 0
            };
            enemy = {
                level: 1,
                attack: 8,
                armor: 3,
                maxHealth: 80,
                currentHealth: 80
            };
            updateUI();
        }

        function startBattle() {
            updateUI();
            gameInterval = setInterval(battleLoop, 1000);
        }

        function battleLoop() {
            if (isPlayerTurn) {
                attackEnemy();
            } else {
                attackPlayer();
            }
            isPlayerTurn = !isPlayerTurn;

            if (enemy.currentHealth <= 0) {
                endBattle('win');
            }
            if (player.currentHealth <= 0) {
                endBattle('lose');
            }
        }

        function attackEnemy() {
            const damage = Math.max(0, player.attack - enemy.armor);
            enemy.currentHealth = Math.max(0, enemy.currentHealth - damage);
            showDamageText('enemy', damage);
            updateUI();
        }

        function attackPlayer() {
            const damage = Math.max(0, enemy.attack - player.armor);
            player.currentHealth = Math.max(0, player.currentHealth - damage);
            showDamageText('player', damage);
            updateUI();
        }

        function showDamageText(target, damage) {
            const element = document.getElementById(target);
            const damageText = document.createElement('div');
            damageText.className = 'damage-text';
            damageText.textContent = `-${damage}`;
            element.appendChild(damageText);
            setTimeout(() => damageText.remove(), 1000);
        }

        function endBattle(result) {
            clearInterval(gameInterval);
            if (result === 'win') {
                player.xp += 50;
                if (player.xp >= player.xpRequired) {
                    levelUp();
                } else {
                    startBattle();
                }
            } else {
                document.getElementById('gameOverScreen').style.display = 'flex';
                saveGame();
            }
        }

        function levelUp() {
            player.level++;
            player.xp -= player.xpRequired;
            player.xpRequired = Math.floor(player.xpRequired * 1.5);
            player.upgradePoints++;
            document.getElementById('upgradePoints').textContent = player.upgradePoints;
                document.getElementById('gameContainer').style.display = 'none';
                document.getElementById('levelUpScreen').style.display = 'flex';
        }

        function upgradeStat(stat) {
            if (player.upgradePoints > 0) {
                player.upgradePoints--;
                player[stat] += 5;
                if (stat === 'maxHealth') player.currentHealth += 5;
                document.getElementById('upgradePoints').textContent = player.upgradePoints;
                if (player.upgradePoints === 0) {
                    document.getElementById('levelUpScreen').style.display = 'none';
                    document.getElementById('gameContainer').style.display = 'flex';
                    startBattle();
                }
            }
        }

        function updateUI() {
            document.getElementById('playerHealth').style.width = `${(player.currentHealth / player.maxHealth) * 100}%`;
            document.getElementById('playerLevel').textContent = player.level;
            document.getElementById('enemyHealth').style.width = `${(enemy.currentHealth / enemy.maxHealth) * 100}%`;
        }

        function saveGame() {
            localStorage.setItem('chaosArenaSave', JSON.stringify(player));
            document.getElementById('continueButton').disabled = false;
        }

        function loadGame() {
            const saved = localStorage.getItem('chaosArenaSave');
            if (saved) {
                const data = JSON.parse(saved);
                player = { ...player, ...data };
                enemy.level = player.level;
                enemy.attack = 8 + (player.level - 1) * 2;
                enemy.armor = 3 + (player.level - 1);
                enemy.maxHealth = 80 + (player.level - 1) * 10;
                enemy.currentHealth = enemy.maxHealth;
                updateUI();
            }
        }

        function showMainMenu() {
            document.getElementById('gameOverScreen').style.display = 'none';
            document.getElementById('mainMenu').style.display = 'flex';
        }

        // Загрузка сохранения при запуске
        loadGame();
        if (localStorage.getItem('chaosArenaSave')) {
            document.getElementById('continueButton').disabled = false;
        }
    </script>
</body>
</html>
