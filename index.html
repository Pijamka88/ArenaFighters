<!DOCTYPE html>
<html>
<head>
    <title>Chocolate Arena</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body {
            background: #3D2B1F;
            color: #D2691E;
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 10px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
        }

        #mainMenu, #battleScreen, #statsScreen {
            display: none;
            flex-direction: column;
            gap: 15px;
            align-items: center;
        }

        .visible {
            display: flex !important;
        }

        button {
            background: #8B4513;
            color: #FFF8DC;
            border: 2px solid #A0522D;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        button:hover {
            transform: scale(1.05);
        }

        .health-bar {
            width: 100px;
            height: 8px;
            background: #A0522D;
            border-radius: 4px;
            margin: 5px;
        }

        .health-fill {
            height: 100%;
            background: #228B22;
            border-radius: 4px;
            transition: width 0.3s;
        }

        .character {
            font-size: 48px;
            margin: 20px;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        #arena {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin: 20px 0;
        }

        #combatLog {
            height: 100px;
            width: 100%;
            overflow-y: auto;
            background: #2B1B14;
            padding: 10px;
            border-radius: 5px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            width: 200px;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <!-- Main Menu -->
    <div id="mainMenu" class="visible">
        <h1>üç´ Chocolate Arena ÔøΩ</h1>
        <button onclick="startGame()">‚öîÔ∏è Start Battle</button>
        <button onclick="showStats()">üìä Player Stats</button>
        <button onclick="window.Telegram.WebApp.close()">üö™ Exit</button>
    </div>

    <!-- Battle Screen -->
    <div id="battleScreen">
        <div id="arena">
            <div>
                <div class="health-bar"><div id="playerHealth" class="health-fill" style="width:100%"></div></div>
                <div class="character" id="playerIcon">üó°Ô∏è</div>
            </div>
            <div>
                <div class="health-bar"><div id="enemyHealth" class="health-fill" style="width:100%"></div></div>
                <div class="character" id="enemyIcon">üëπ</div>
            </div>
        </div>
        <div id="combatLog"></div>
        <button onclick="returnToMenu()">üè† Menu</button>
    </div>

    <!-- Stats Screen -->
    <div id="statsScreen">
        <h2>üìú Player Stats</h2>
        <div class="stat-item"><span>Level:</span><span id="statLevel">1</span></div>
        <div class="stat-item"><span>Health:</span><span id="statHealth">100</span></div>
        <div class="stat-item"><span>Attack:</span><span id="statAttack">10</span></div>
        <div class="stat-item"><span>Gold:</span><span id="statGold">0</span></div>
        <button onclick="upgradeStat('health')">‚ù§Ô∏è Upgrade Health (+20)</button>
        <button onclick="upgradeStat('attack')">‚öîÔ∏è Upgrade Attack (+5)</button>
        <button onclick="returnToMenu()">üîô Back</button>
    </div>

    <script>
        let player = {
            level: 1,
            health: 100,
            maxHealth: 100,
            attack: 10,
            gold: 0,
            wins: 0,
            xp: 0
        };

        let currentEnemy = null;
        let combatInterval = null;

        function createEnemy(isBoss = false) {
            return {
                health: isBoss ? 200 + player.wins * 50 : 50 + player.wins * 20,
                maxHealth: isBoss ? 200 + player.wins * 50 : 50 + player.wins * 20,
                attack: isBoss ? 20 + player.wins * 5 : 10 + player.wins * 3,
                icon: isBoss ? 'üêâ' : 'üëπ'
            };
        }

        function startGame() {
            player.health = player.maxHealth;
            currentEnemy = createEnemy(player.wins % 5 === 4);
            updateUI();
            showScreen('battleScreen');
            startCombat();
        }

        function startCombat() {
            combatInterval = setInterval(() => {
                // Player attack
                const playerDamage = Math.floor(player.attack * (0.8 + Math.random() * 0.4));
                currentEnemy.health -= playerDamage;
                logCombat(`You hit for ${playerDamage} damage!`);
                
                // Enemy attack
                if(currentEnemy.health > 0) {
                    const enemyDamage = Math.floor(currentEnemy.attack * (0.8 + Math.random() * 0.4));
                    player.health -= enemyDamage;
                    logCombat(`Enemy hits for ${enemyDamage} damage!`);
                }

                // Check combat results
                if(player.health <= 0) {
                    endCombat(false);
                } else if(currentEnemy.health <= 0) {
                    endCombat(true);
                }
                
                updateUI();
            }, 1500);
        }

        function endCombat(victory) {
            clearInterval(combatInterval);
            if(victory) {
                player.wins++;
                player.gold += 50;
                player.xp += 100;
                logCombat("Victory! +50 gold +100 XP");
                checkLevelUp();
                setTimeout(startGame, 2000);
            } else {
                logCombat("You were defeated...");
                returnToMenu();
            }
        }

        function checkLevelUp() {
            if(player.xp >= player.level * 200) {
                player.xp = 0;
                player.level++;
                player.maxHealth += 20;
                player.attack += 5;
                logCombat(`Level up! Now level ${player.level}`);
            }
        }

        function upgradeStat(stat) {
            if(player.gold >= 100) {
                player.gold -= 100;
                if(stat === 'health') {
                    player.maxHealth += 20;
                } else {
                    player.attack += 5;
                }
                updateStatsDisplay();
            }
        }

        function updateUI() {
            document.getElementById('playerHealth').style.width = 
                `${(player.health / player.maxHealth) * 100}%`;
            document.getElementById('enemyHealth').style.width = 
                `${(currentEnemy.health / currentEnemy.maxHealth) * 100}%`;
            document.getElementById('enemyIcon').textContent = currentEnemy.icon;
        }

        function updateStatsDisplay() {
            document.getElementById('statLevel').textContent = player.level;
            document.getElementById('statHealth').textContent = player.maxHealth;
            document.getElementById('statAttack').textContent = player.attack;
            document.getElementById('statGold').textContent = player.gold;
        }

        function logCombat(message) {
            const log = document.getElementById('combatLog');
            log.innerHTML += `<div>${message}</div>`;
            log.scrollTop = log.scrollHeight;
        }

        function showScreen(screenId) {
            document.querySelectorAll('div[id$="Screen"]').forEach(el => 
                el.classList.remove('visible'));
            document.getElementById(screenId).classList.add('visible');
        }

        function showStats() {
            updateStatsDisplay();
            showScreen('statsScreen');
        }

        function returnToMenu() {
            player.wins = 0;
            showScreen('mainMenu');
        }

        // Initialize Telegram Web App
        window.Telegram.WebApp.ready();
        window.Telegram.WebApp.expand();
    </script>
</body>
</html>