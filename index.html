<!DOCTYPE html>
<html>
<head>
    <title>Dark Arena Evolution</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            margin: 0;
            background: #4A2B0F;
            color: #D4A574;
            font-family: 'Arial', sans-serif;
            text-align: center;
        }

        #mainMenu, #arena {
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        .button {
            background: #6B4423;
            border: 2px solid #8B5E3C;
            color: #FFE4C4;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border-radius: 5px;
            transition: transform 0.2s;
        }

        .button:active {
            transform: scale(0.95);
        }

        .character {
            font-size: 64px;
            margin: 20px;
            animation: pulse 1.5s infinite;
        }

        .health-bar {
            width: 200px;
            height: 20px;
            background: #3D2010;
            margin: 10px auto;
            border-radius: 5px;
            overflow: hidden;
        }

        .health-fill {
            height: 100%;
            background: #50C878;
            transition: width 0.3s;
        }

        #battleLog {
            max-height: 100px;
            overflow-y: auto;
            background: #3D2010;
            padding: 10px;
            margin: 20px;
            border-radius: 5px;
            text-align: left;
        }

        .hidden {
            display: none;
        }

        .modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #5A3415;
            padding: 20px;
            border-radius: 10px;
            z-index: 1000;
            border: 2px solid #8B5E3C;
        }

        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes hit {
            0% { transform: translateX(0); }
            25% { transform: translateX(10px); }
            50% { transform: translateX(-10px); }
            100% { transform: translateX(0); }
        }

        .hit-animation { animation: hit 0.3s linear; }
        .achievement { color: #FFD700; font-weight: bold; }
        .boss-warning { color: #FF0000; animation: pulse 0.5s infinite; }
        #continueButton { background: #2E8B57; }
    </style>
</head>
<body>
    <div id="mainMenu">
        <h1>üè∞ Dark Arena ‚öîÔ∏è</h1>
        <div class="stats">
            <p>–£—Ä–æ–≤–µ–Ω—å: <span id="level">1</span></p>
            <p>–û–ø—ã—Ç: <span id="xp">0</span>/100</p>
            <p>–ú–æ–Ω–µ—Ç—ã: <span id="coins">0</span></p>
            <p>‚öîÔ∏è –ê—Ç–∞–∫–∞: <span id="attack">10</span></p>
            <p>üõ°Ô∏è –ó–∞—â–∏—Ç–∞: <span id="defense">0</span></p>
            <p>‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ: <span id="maxHealth">100</span></p>
            <p>üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è: <span id="achievements">–ù–µ—Ç</span></p>
        </div>
        <button class="button" onclick="startGame()">–ù–∞—á–∞—Ç—å –±–æ–π</button>
        <button class="button" onclick="showUpgrades()">–£–ª—É—á—à–µ–Ω–∏—è</button>
    </div>

    <div id="arena" class="hidden">
        <div id="playerArea">
            <div class="health-bar"><div id="playerHealth" class="health-fill" style="width: 100%"></div></div>
            <div class="character" id="playerIcon">ü¶Å</div>
        </div>
        <div id="enemyArea">
            <div class="health-bar"><div id="enemyHealth" class="health-fill" style="width: 100%"></div></div>
            <div class="character" id="enemyIcon">ü¶ä</div>
        </div>
        <div id="battleLog"></div>
        <button class="button" onclick="returnToMenu()" id="menuButton">–í –º–µ–Ω—é</button>
        <button class="button hidden" onclick="continueBattle()" id="continueButton">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –±–æ–π</button>
    </div>

    <div id="upgradeModal" class="hidden modal">
        <h3>–£–ª—É—á—à–µ–Ω–∏—è</h3>
        <button class="button" onclick="upgradeStat('attack')">‚öîÔ∏è +5 –ê—Ç–∞–∫–∏ (50üí∞)</button>
        <button class="button" onclick="upgradeStat('health')">‚ù§Ô∏è +20 –ó–¥–æ—Ä–æ–≤—å—è (50üí∞)</button>
        <button class="button" onclick="upgradeStat('defense')">üõ°Ô∏è +3 –ó–∞—â–∏—Ç—ã (75üí∞)</button>
        <button class="button" onclick="hideUpgrades()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
    <div id="modalBackdrop" class="hidden modal-backdrop"></div>

    <script>
        const ENEMY_TYPES = {
            WARRIOR: { icon: 'üõ°Ô∏è', attack: 15, defense: 5 },
            ARCHER: { icon: 'üèπ', attack: 20, defense: 2 },
            MAGE: { icon: 'üîÆ', attack: 25, defense: 0 }
        };

        const ACHIEVEMENTS = [
            { condition: p => p.wins >= 5, title: "–ù–æ–≤–∏—á–æ–∫ –∞—Ä–µ–Ω—ã", done: false },
            { condition: p => p.coins >= 200, title: "–ë–æ–≥–∞—á", done: false },
            { condition: p => p.wins >= 10, title: "–û–ø—ã—Ç–Ω—ã–π –±–æ–µ—Ü", done: false }
        ];

        let player = {
            level: 1,
            xp: 0,
            coins: 0,
            attack: 10,
            defense: 0,
            health: 100,
            maxHealth: 100,
            wins: 0,
            achievements: []
        };

        let currentEnemy = null;
        let battleInterval = null;

        function loadGame() {
            const saved = localStorage.getItem('arenaSave');
            if(saved) Object.assign(player, JSON.parse(saved));
            updateStatsDisplay();
        }

        function saveGame() {
            localStorage.setItem('arenaSave', JSON.stringify(player));
        }

        function createEnemy(isBoss = false) {
            const type = Object.values(ENEMY_TYPES)[Math.floor(Math.random() * 3)];
            return {
                ...type,
                health: isBoss ? 500 : 100 + player.wins * 30,
                attack: type.attack * (isBoss ? 2 : 1) + player.wins * 5,
                defense: type.defense + player.wins * 2,
                icon: isBoss ? 'üêâ' : type.icon
            };
        }

        function startGame() {
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('arena').classList.remove('hidden');
            player.health = player.maxHealth;
            currentEnemy = createEnemy(player.wins >= 5);
            
            if(player.wins >= 5) {
                logBattle('<div class="boss-warning">!!! –ü–û–Ø–í–õ–ï–ù–ò–ï –ë–û–°–°–ê !!!</div>');
                player.wins = 0;
            }

            updateHealthBars();
            document.getElementById('enemyIcon').textContent = currentEnemy.icon;
            document.getElementById('continueButton').classList.add('hidden');
            document.getElementById('menuButton').classList.remove('hidden');
            
            battleInterval = setInterval(fightRound, 1500);
        }

        function fightRound() {
            const crit = Math.random() < 0.2;
            const playerDamage = Math.max(0, (player.attack * (crit ? 1.5 : 1)) - currentEnemy.defense);
            currentEnemy.health -= playerDamage;
            document.getElementById('enemyIcon').classList.add('hit-animation');
            logBattle(`${crit ? 'üí• –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –£–î–ê–†! ' : ''}–í—ã –Ω–∞–Ω–µ—Å–ª–∏ ${playerDamage} —É—Ä–æ–Ω–∞!`);

            const enemyDamage = Math.max(0, currentEnemy.attack - player.defense);
            player.health -= enemyDamage;
            document.getElementById('playerIcon').classList.add('hit-animation');
            logBattle(`–í—Ä–∞–≥ –Ω–∞–Ω–µ—Å ${enemyDamage} —É—Ä–æ–Ω–∞!`);

            setTimeout(() => {
                document.getElementById('enemyIcon').classList.remove('hit-animation');
                document.getElementById('playerIcon').classList.remove('hit-animation');
            }, 300);

            updateHealthBars();

            if(currentEnemy.health <= 0) endBattle(true);
            else if(player.health <= 0) endBattle(false);
        }

        function endBattle(victory) {
            clearInterval(battleInterval);
            if(victory) {
                player.wins++;
                player.xp += 25;
                player.coins += 10;
                logBattle("üéâ –ü–æ–±–µ–¥–∞! +25 –æ–ø—ã—Ç–∞ +10 –º–æ–Ω–µ—Ç");
                
                if(player.xp >= 100) {
                    player.level++;
                    player.attack += 5;
                    player.maxHealth += 20;
                    player.xp = 0;
                    logBattle("‚ú® –£—Ä–æ–≤–µ–Ω—å –ø–æ–≤—ã—à–µ–Ω! +5 –∞—Ç–∞–∫–∏ +20 –∑–¥–æ—Ä–æ–≤—å—è");
                }
                
                checkAchievements();
                document.getElementById('continueButton').classList.remove('hidden');
                document.getElementById('menuButton').classList.add('hidden');
            } else {
                logBattle("üíÄ –ü–æ—Ä–∞–∂–µ–Ω–∏–µ...");
                player.wins = 0;
                document.getElementById('continueButton').classList.add('hidden');
                document.getElementById('menuButton').classList.remove('hidden');
            }
            
            updateStatsDisplay();
            saveGame();
        }

        function continueBattle() {
            player.health = player.maxHealth;
            currentEnemy = createEnemy(player.wins >= 5);
            document.getElementById('enemyIcon').textContent = currentEnemy.icon;
            updateHealthBars();
            document.getElementById('continueButton').classList.add('hidden');
            document.getElementById('menuButton').classList.remove('hidden');
            battleInterval = setInterval(fightRound, 1500);
        }

        function upgradeStat(stat) {
            const costs = { attack: 50, health: 50, defense: 75 };
            if(player.coins >= costs[stat]) {
                player.coins -= costs[stat];
                if(stat === 'attack') player.attack += 5;
                if(stat === 'health') player.maxHealth += 20;
                if(stat === 'defense') player.defense += 3;
                updateStatsDisplay();
                saveGame();
                hideUpgrades();
            }
        }

        function checkAchievements() {
            ACHIEVEMENTS.forEach(ach => {
                if(!ach.done && ach.condition(player)) {
                    logBattle(`<div class="achievement">üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: ${ach.title}!</div>`);
                    ach.done = true;
                    player.achievements.push(ach.title);
                    document.getElementById('achievements').textContent = player.achievements.join(', ');
                }
            });
        }

        function updateHealthBars() {
            // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–∞ —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –∑–¥–æ—Ä–æ–≤—å—è
            const playerHealthPercent = Math.max(0, Math.min(100, 
                (player.health / player.maxHealth) * 100));
            const enemyHealthPercent = Math.max(0, Math.min(100, 
                (currentEnemy.health / currentEnemy.maxHealth) * 100));
            
            document.getElementById('playerHealth').style.width = `${playerHealthPercent}%`;
            document.getElementById('enemyHealth').style.width = `${enemyHealthPercent}%`;
        }

        function updateStatsDisplay() {
            document.getElementById('level').textContent = player.level;
            document.getElementById('xp').textContent = player.xp;
            document.getElementById('coins').textContent = player.coins;
            document.getElementById('attack').textContent = player.attack;
            document.getElementById('defense').textContent = player.defense;
            document.getElementById('maxHealth').textContent = player.maxHealth;
            document.getElementById('achievements').textContent = 
                player.achievements.length > 0 ? player.achievements.join(', ') : '–ù–µ—Ç';
        }

        function logBattle(text) {
            const log = document.getElementById('battleLog');
            const newEntry = document.createElement('div');
            newEntry.innerHTML = text;
            log.appendChild(newEntry);
            log.scrollTop = log.scrollHeight;
        }

        function showUpgrades() {
            document.getElementById('upgradeModal').classList.remove('hidden');
            document.getElementById('modalBackdrop').classList.remove('hidden');
        }

        function hideUpgrades() {
            document.getElementById('upgradeModal').classList.add('hidden');
            document.getElementById('modalBackdrop').classList.add('hidden');
        }

        function returnToMenu() {
            document.getElementById('mainMenu').classList.remove('hidden');
            document.getElementById('arena').classList.add('hidden');
            clearInterval(battleInterval);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        window.onload = loadGame;
    </script>
</body>
</html>