<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mad Cow Hunt</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --main-color: #FF5722;
            --secondary-color: #4CAF50;
            --bg-color: #1A237E;
        }

        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            touch-action: none;
            font-family: 'Arial Black', sans-serif;
            background: var(--bg-color);
            color: white;
        }

        #gameCanvas {
            position: absolute;
            top: 0;
            left: 0;
        }

        #mainMenu {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            background: rgba(0,0,0,0.9);
            padding: 2rem;
            border-radius: 15px;
            border: 3px solid var(--main-color);
            z-index: 2;
        }

        .menuBtn {
            padding: 1rem 2rem;
            font-size: 1.2rem;
            background: linear-gradient(45deg, var(--main-color), #FF9800);
            border: none;
            color: white;
            border-radius: 8px;
            margin: 0.5rem;
            cursor: pointer;
            transition: transform 0.2s;
            width: 200px;
        }

        .menuBtn:hover {
            transform: scale(1.05);
        }

        #hud {
            position: fixed;
            top: 10px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            box-sizing: border-box;
            z-index: 1;
        }

        #bottomPanel {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .life {
            width: 30px;
            height: 30px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23ff0000"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>');
            margin-left: 5px;
        }

        #crosshair {
            position: absolute;
            width: 32px;
            height: 32px;
            pointer-events: none;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23FF5722"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-12.5c-2.49 0-4.5 2.01-4.5 4.5s2.01 4.5 4.5 4.5 4.5-2.01 4.5-4.5-2.01-4.5-4.5-4.5zm0 7c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>');
            background-size: contain;
            filter: drop-shadow(0 0 5px rgba(255,87,34,0.7));
        }

        #gun {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 80px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23ffffff"><path d="M20 3h-5c0-1.7-1.3-3-3-3S9 1.3 9 3H4v2h1l1.5 6.7c-.6.3-1 1-1 1.8v8c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2v-8c0-.8-.4-1.5-1-1.8L19 5h1V3zM12 3c.6 0 1 .4 1 1h-2c0-.6.4-1 1-1zm6 18H6v-7h12v7zm-6-11c-1.1 0-2-.9-2-2h4c0 1.1-.9 2-2 2z"/></svg>');
            background-size: contain;
            transition: transform 0.1s;
        }

        .paused {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            color: var(--main-color);
            text-shadow: 0 0 10px black;
            z-index: 3;
            display: none;
        }
    </style>
</head>
<body>
    <div id="mainMenu">
        <h1 style="color: var(--main-color); margin-bottom: 2rem;">MAD COW HUNT</h1>
        <button class="menuBtn" id="startBtn">START GAME</button>
        <button class="menuBtn" id="howToBtn">HOW TO PLAY</button>
        <button class="menuBtn" id="highscoresBtn">HIGH SCORES</button>
    </div>

    <div id="hud">
        <div>SCORE: <span id="score">0</span></div>
        <div id="lives"></div>
    </div>

    <div id="bottomPanel">
        <div>AMMO: <span id="ammo">10</span></div>
        <div>HITS: <span id="hits">0</span></div>
        <div>MISS: <span id="miss">0</span></div>
        <button id="pauseBtn" style="background: none; border: none;">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="#fff">
                <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
            </svg>
        </button>
    </div>

    <div id="crosshair"></div>
    <div id="gun"></div>
    <div class="paused">PAUSED</div>
    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const SCORE_KEY = 'madCowHighscores';
        
        class GameState {
            constructor() {
                this.reset();
            }
            
            reset() {
                this.cows = [];
                this.score = 0;
                this.ammo = 10;
                this.lives = 3;
                this.hits = 0;
                this.miss = 0;
                this.isPlaying = false;
                this.paused = false;
                this.lastSpawn = 0;
                this.maxCows = 4;
                this.cowTypes = [
                    { speed: 2, color: '#8B4513', score: 20 },
                    { speed: 3.5, color: '#A0522D', score: 30 },
                    { speed: 4.5, color: '#CD853F', score: 50 }
                ];
            }
        }

        let game = new GameState();
        let crosshairPos = { x: 0, y: 0 };
        let highscores = JSON.parse(localStorage.getItem(SCORE_KEY)) || [];

        // Canvas setup
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Input handling
        document.addEventListener('mousemove', e => {
            crosshairPos = { x: e.clientX, y: e.clientY };
            document.getElementById('crosshair').style.transform = 
                `translate(${e.clientX - 16}px, ${e.clientY - 16}px)`;
        });

        document.addEventListener('touchmove', e => {
            e.preventDefault();
            crosshairPos = { x: e.touches[0].clientX, y: e.touches[0].clientY };
            document.getElementById('crosshair').style.transform = 
                `translate(${e.touches[0].clientX - 16}px, ${e.touches[0].clientY - 16}px)`;
        }, { passive: false });

        // Game functions
        class Cow {
            constructor(type) {
                this.type = type;
                this.x = Math.random() < 0.5 ? -100 : canvas.width + 100;
                this.y = Math.random() * (canvas.height - 100);
                this.speed = type.speed * (this.x < 0 ? 1 : -1);
                this.angle = 0;
                this.health = 1;
                this.width = 60;
                this.height = 40;
            }

            update() {
                this.x += this.speed;
                this.y += Math.sin(this.angle) * 2;
                this.angle += 0.1;
            }

            draw() {
                ctx.fillStyle = this.type.color;
                ctx.beginPath();
                ctx.ellipse(this.x + 30, this.y + 20, 30, 20, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // Wings
                ctx.strokeStyle = 'rgba(255,255,255,0.5)';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(this.x + 40, this.y + 15);
                ctx.lineTo(this.x + 40 + Math.cos(Date.now()*0.01)*15, 
                         this.y + 15 + Math.sin(Date.now()*0.01)*5);
                ctx.stroke();
            }
        }

        function spawnCow() {
            if(game.cows.length >= game.maxCows) return;
            const type = game.cowTypes[Math.floor(Math.random() * game.cowTypes.length)];
            game.cows.push(new Cow(type));
        }

        function checkCollision(cow) {
            const rect = canvas.getBoundingClientRect();
            const cx = crosshairPos.x - rect.left;
            const cy = crosshairPos.y - rect.top;
            return cx > cow.x && cx < cow.x + cow.width &&
                   cy > cow.y && cy < cow.y + cow.height;
        }

        function updateHUD() {
            document.getElementById('score').textContent = game.score;
            document.getElementById('ammo').textContent = game.ammo;
            document.getElementById('hits').textContent = game.hits;
            document.getElementById('miss').textContent = game.miss;
            
            let livesHTML = '';
            for(let i = 0; i < game.lives; i++) {
                livesHTML += '<div class="life"></div>';
            }
            document.getElementById('lives').innerHTML = livesHTML;
        }

        function gameLoop() {
            if(!game.isPlaying || game.paused) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Spawn cows
            if(Date.now() - game.lastSpawn > 1500) {
                spawnCow();
                game.lastSpawn = Date.now();
            }

            // Update cows
            game.cows = game.cows.filter(cow => {
                cow.update();
                
                // Check if cow escaped
                if(cow.x < -150 || cow.x > canvas.width + 150) {
                    game.lives--;
                    if(game.lives <= 0) gameOver();
                    return false;
                }
                return true;
            });

            // Draw cows
            game.cows.forEach(cow => cow.draw());

            updateHUD();
            requestAnimationFrame(gameLoop);
        }

        function shoot() {
            if(!game.isPlaying || game.paused || game.ammo <= 0) return;

            game.ammo--;
            let hit = false;

            game.cows = game.cows.filter(cow => {
                if(checkCollision(cow)) {
                    game.score += cow.type.score;
                    game.hits++;
                    hit = true;
                    return false;
                }
                return true;
            });

            if(!hit) game.miss++;
            if(game.ammo <= 0) reload();

            // Gun animation
            document.getElementById('gun').style.transform = 
                `translateX(-50%) scale(1.2)`;
            setTimeout(() => {
                document.getElementById('gun').style.transform = 
                    `translateX(-50%) scale(1)`;
            }, 100);
        }

        function reload() {
            game.ammo = 10;
            game.miss++;
        }

        function gameOver() {
            game.isPlaying = false;
            document.getElementById('mainMenu').style.display = 'block';
            updateHighscores(game.score);
            alert(`GAME OVER! Score: ${game.score}`);
        }

        function updateHighscores(score) {
            highscores.push(score);
            highscores.sort((a,b) => b - a);
            highscores = highscores.slice(0, 5);
            localStorage.setItem(SCORE_KEY, JSON.stringify(highscores));
        }

        // Event listeners
        document.addEventListener('mousedown', shoot);
        document.addEventListener('touchstart', (e) => {
            e.preventDefault();
            shoot();
        });

        document.getElementById('startBtn').addEventListener('click', () => {
            document.getElementById('mainMenu').style.display = 'none';
            game.reset();
            game.isPlaying = true;
            gameLoop();
        });

        document.getElementById('howToBtn').addEventListener('click', () => {
            alert(`HOW TO PLAY:
- Shoot flying cows with your crosshair
- You have 10 bullets before auto-reload
- 3 types of cows with different speeds
- 3 lives - don't let cows escape!
- Manage your ammo carefully
- Different cows give different points
- Top 5 scores are saved locally`);
        });

        document.getElementById('highscoresBtn').addEventListener('click', () => {
            const scores = highscores.length > 0 ? 
                highscores.join('\n') : 'No scores yet!';
            alert(`TOP 5 SCORES:\n${scores}`);
        });

        document.getElementById('pauseBtn').addEventListener('click', () => {
            game.paused = !game.paused;
            document.querySelector('.paused').style.display = 
                game.paused ? 'block' : 'none';
            if(game.paused) cancelAnimationFrame(animationFrame);
            else gameLoop();
        });

        // Init
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
        updateHUD();
    </script>
</body>
</html>