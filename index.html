<!DOCTYPE html>
<html>
<head>
    <title>Бои на арене</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #arena {
            border: 2px solid #333;
            background: #f0f0f0;
        }

        .menu {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 10px 0;
        }

        .status {
            margin: 20px;
            padding: 10px;
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .log {
            width: 300px;
            height: 200px;
            margin: 10px;
            padding: 10px;
            overflow-y: scroll;
            background: #f9f9f9;
            border: 1px solid #ddd;
        }

        .skill-pane {
            display: none;
            padding: 10px;
            background: #fff;
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>
<canvas id="arena" width="600" height="400"></canvas>

<div class="menu">
    <button onclick="startBattle()">Начать бой</button>
    <button onclick="showSkills()">Прокачка</button>
</div>

<div class="status" id="status"></div>

<div class="log" id="log"></div>

<div class="skill-pane" id="skill-pane">
    <button onclick="allocate('health')">Жизни (+10)</button>
    <button onclick="allocate('energy')">Энергия (+5)</button>
    <button onclick="allocate('armor')">Броня (+2)</button>
</div>

<script>
    const canvas = document.getElementById('arena');
    const ctx = canvas.getContext('2d');
    const log = document.getElementById('log');
    const status = document.getElementById('status');
    const skillPane = document.getElementById('skill-pane');

    class Character {
        constructor(name, health, energy, armor) {
            this.name = name;
            this.health = health;
            this.maxHealth = health;
            this.energy = energy;
            this.armor = armor;
            this.level = 1;
            this.exp = 0;
            this.expToLevel = 100;
            this.skillPoints = 0;
            this.position = {x: 50, y: 200};
        }

        attack(target) {
            const damage = Math.floor((this.energy / 2) * (Math.random() * 0.5 + 0.5));
            target.takeDamage(damage);
            return damage;
        }

        takeDamage(damage) {
            const realDamage = Math.max(0, damage - this.armor);
            this.health -= realDamage;
            return realDamage;
        }

        isAlive() {
            return this.health > 0;
        }
    }

    const player = new Character("Герой", 100, 50, 10);
    let currentBot = null;
    let battleRunning = false;
    let battleInterval = null;

    function logMessage(message) {
        const logEntry = document.createElement('div');
        logEntry.textContent = message;
        log.appendChild(logEntry);
        log.scrollTop = log.scrollHeight;
    }

    function updateUI() {
        status.textContent = `Уровень: ${player.level}\nОпыт: ${player.exp}/${player.expToLevel}\nЖизни: ${player.health}/${player.maxHealth}\nЭнергия: ${player.energy}\nБроня: ${player.armor}`;
        if (player.skillPoints > 0) {
            skillPane.style.display = 'block';
        } else {
            skillPane.style.display = 'none';
        }
    }

    function generateBot() {
        const level = player.level;
        return new Character(
            `Бот ${Math.floor(Math.random() * 1000)}`,
            Math.floor((level + 1) * 10 + Math.random() * 20),
            Math.floor((level + 1) * 5 + Math.random() * 10),
            Math.floor((level + 1) * 2 + Math.random() * 4),
            {x: 450, y: 200}
        );
    }

    function startBattle() {
        if (battleRunning) return;
        currentBot = generateBot();
        log.innerHTML = '';
        logMessage('Начало боя!');
        battleRunning = true;
        battleLoop();
    }

    function battleLoop() {
        if (!player.isAlive() || !currentBot.isAlive()) {
            endBattle();
            return;
        }

        // Отрисовка
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawCharacter(player);
        drawCharacter(currentBot);
        drawHealthBars();

        // Ходы
        const playerDamage = player.attack(currentBot);
        const botDamage = currentBot.attack(player);

        logMessage(`Герой нанес ${playerDamage} урона`);
        logMessage(`Бот нанес ${botDamage} урона`);

        setTimeout(battleLoop, 1000);
    }

    function endBattle() {
        if (currentBot.health <= 0) {
            logMessage('Победа!');
            player.exp += currentBot.level * 10;
            checkLevelUp();
        } else {
            logMessage('Поражение!');
        }
        battleRunning = false;
        updateUI();
    }

    function checkLevelUp() {
        while (player.exp >= player.expToLevel) {
            player.level++;
            player.exp -= player.expToLevel;
            player.expToLevel = Math.round(player.expToLevel * 1.5);
            player.skillPoints++;
        }
    }

    function allocate(stat) {
        if (player.skillPoints === 0) return;

        player.skillPoints--;
        switch (stat) {
            case 'health':
                player.maxHealth += 10;
                player.health = player.maxHealth;
                break;
            case 'energy':
                player.energy += 5;
                break;
            case 'armor':
                player.armor += 2;
                break;
        }

        updateUI();
    }

    function drawCharacter(char) {
        ctx.fillStyle = char === player ? '#00f' : '#f00';
        ctx.fillRect(char.position.x, char.position.y, 50, 50);
    }

    function drawHealthBars() {
        ctx.fillStyle = '#ff0000';
        ctx.fillRect(50, 180, 50 * (player.health / player.maxHealth), 10);
        ctx.fillStyle = '#00ff00';
        ctx.fillRect(currentBot.position.x, 180, 50 * (currentBot.health / currentBot.maxHealth), 10);
    }

    function showSkills() {
        if (player.skillPoints > 0) {
            skillPane.style.display = 'block';
        }
    }

    updateUI();
</script>
</body>
</html>
