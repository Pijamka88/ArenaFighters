<!DOCTYPE html>
<html>
<head>
    <title>Chaos Fighters</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #f0f0f0;
        }

        #main-menu {
            text-align: center;
            margin-top: 50px;
        }

        button {
            margin: 10px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }

        #arena {
            display: none;
            position: relative;
            text-align: center;
            margin-top: 50px;
        }

        #battleCanvas {
            border: 1px solid #000;
            background: #e0e0e0;
        }

        .healthBar {
            width: 300px;
            height: 20px;
            background-color: #ddd;
            margin: 10px auto;
            position: relative;
        }

        .playerHealth { background-color: green; }
        .enemyHealth { background-color: red; }

        .healthBar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background-color: #555;
            transition: width 0.3s;
        }

        #battleLog {
            margin-top: 20px;
            max-height: 100px;
            overflow-y: auto;
            background-color: #f0f0f0;
            padding: 10px;
            border: 1px solid #ccc;
        }

        #stats {
            display: none;
            padding: 20px;
            background: white;
            border: 1px solid #ccc;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div id="main-menu">
        <h1>CHAOS FIGHTERS</h1>
        <button onclick="startBattle()">Начать бой</button>
        <button onclick="showStats()">Характеристики</button>
    </div>

    <div id="arena">
        <canvas id="battleCanvas" width="400" height="300"></canvas>
        <div id="healthBars">
            <div class="healthBar playerHealth"></div>
            <div class="healthBar enemyHealth"></div>
        </div>
        <div id="battleLog"></div>
    </div>

    <div id="stats">
        <h2>Характеристики</h2>
        <div id="playerStats"></div>
        <button onclick="showMainMenu()">Назад</button>
    </div>

<script>
let player = {
    health: 100,
    attack: 10,
    defense: 5,
    level: 1,
    exp: 0,
    expToNext: 100
};

let currentEnemy = null;
let battleState = 'menu';
const canvas = document.getElementById('battleCanvas');
const ctx = canvas.getContext('2d');

function startBattle() {
    if (battleState !== 'menu') return;
    battleState = 'battle';
    showSection('arena');
    generateEnemy();
    battleLoop();
}

function generateEnemy() {
    const level = player.level;
    currentEnemy = {
        health: 100 + 20*level,
        attack: 8 + 2*level,
        defense: 3 + level,
        name: `Враг Lv${level}`
    };
    updateHealthBars();
}

function battleLoop() {
    if (currentEnemy.health <= 0) {
        endBattle(true);
        return;
    }
    if (player.health <= 0) {
        endBattle(false);
        return;
    }

    playerTurn();
    setTimeout(() => {
        enemyTurn();
        setTimeout(battleLoop, 1000);
    }, 1000);
}

function playerTurn() {
    const damage = Math.max(0, player.attack - currentEnemy.defense);
    currentEnemy.health -= damage;
    drawAttack('player');
    updateHealthBars();
    addLog(`Вы нанесли ${damage} урона`);
}

function enemyTurn() {
    const damage = Math.max(0, currentEnemy.attack - player.defense);
    player.health -= damage;
    drawAttack('enemy');
    updateHealthBars();
    addLog(`Противник нанёс ${damage} урона`);
}

function endBattle(won) {
    battleState = 'menu';
    if (won) {
        player.exp += 50 + 10*player.level;
        checkLevelUp();
        addLog(`Победа! Получено ${50 + 10*player.level} опыта`);
    } else {
        addLog('Вы проиграли!');
    }
    setTimeout(() => {
        showSection('main-menu');
        clearBattle();
    }, 2000);
}

function checkLevelUp() {
    while (player.exp >= player.expToNext) {
        player.level++;
        player.exp -= player.expToNext;
        player.expToNext = Math.floor(player.expToNext * 1.5);
        player.health += 20;
        player.attack += 5;
        player.defense += 3;
        addLog(`Уровень повышен до ${player.level}!`);
    }
}

function showSection(id) {
    document.querySelectorAll('div').forEach(e => e.style.display = 'none');
    document.getElementById(id).style.display = 'block';
}

function showStats() {
    if (battleState === 'battle') return;
    showSection('stats');
    document.getElementById('playerStats').innerHTML = `
        Уровень: ${player.level}<br>
        Здоровье: ${player.health}<br>
        Атака: ${player.attack}<br>
        Защита: ${player.defense}<br>
        Опыт: ${player.exp}/${player.expToNext}
    `;
}

function showMainMenu() {
    showSection('main-menu');
}

function updateHealthBars() {
    const playerBar = document.querySelector('.playerHealth');
    playerBar.style.width = `${(player.health/100)*100}%`;
    
    const enemyBar = document.querySelector('.enemyHealth');
    enemyBar.style.width = `${(currentEnemy.health/100)*100}%`;
}

function addLog(message) {
    const log = document.getElementById('battleLog');
    log.innerHTML += `<div>${message}</div>`;
    log.scrollTop = log.scrollHeight;
}

function drawAttack(who) {
    clearCanvas();
    ctx.beginPath();
    ctx.lineWidth = 5;
    ctx.strokeStyle = who === 'player' ? 'green' : 'red';
    
    if (who === 'player') {
        ctx.moveTo(50, 150);
        ctx.lineTo(350, 150);
    } else {
        ctx.moveTo(350, 150);
        ctx.lineTo(50, 150);
    }
    
    ctx.stroke();
    setTimeout(clearCanvas, 500);
}

function clearCanvas() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
}

function clearBattle() {
    currentEnemy = null;
    document.getElementById('battleLog').innerHTML = '';
}
</script>
</body>
</html>
