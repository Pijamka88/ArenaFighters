<!DOCTYPE html>
<html>
<head>
    <title>Chaos Fighters</title>
    <style>
        body { font-family: Arial; }
        #menu, #arena, #stats { margin: 20px; }
        .hpBar { 
            width: 200px; height: 20px; 
            background: #f0f0f0; border: 1px solid #000; 
            position: relative; margin: 10px;
        }
        .hpBar::before {
            content: ''; position: absolute; 
            top: 0; left: 0; height: 100%;
            background: green; transition: width 0.3s;
        }
        .attack { animation: attack 0.5s; }
        .hit { animation: hit 0.5s; }
        
        @keyframes attack { 
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        @keyframes hit { 
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div id="menu">
        <h1>Chaos Fighters</h1>
        <button onclick="startBattle()">Начать бой</button>
        <button onclick="showStats()">Характеристики</button>
    </div>

    <div id="arena" style="display: none;">
        <div>Игрок</div>
        <div id="playerHp" class="hpBar"></div>
        <div>Противник</div>
        <div id="enemyHp" class="hpBar"></div>
        <div id="battleLog"></div>
    </div>

    <div id="stats" style="display: none;">
        <button onclick="backToMenu()">Назад</button>
        <div id="statsContent"></div>
    </div>

<script>
let player = {
    level: 1,
    exp: 0,
    maxExp: 100,
    stats: {
        hp: 100,
        attack: 10,
        defense: 5
    },
    currentHp: 100
};

let enemy = {
    stats: { hp: 0, attack: 0, defense: 0 },
    currentHp: 0
};

function loadPlayer() {
    let savedPlayer = localStorage.getItem('chaosFighter');
    if (savedPlayer) {
        player = JSON.parse(savedPlayer);
    }
}

function savePlayer() {
    localStorage.setItem('chaosFighter', JSON.stringify(player));
}

function updateHpBars() {
    document.getElementById('playerHp').style.width = 
        (player.currentHp / player.stats.hp * 100) + '%';
    document.getElementById('enemyHp').style.width = 
        (enemy.currentHp / enemy.stats.hp * 100) + '%';
}

function generateEnemy() {
    enemy.level = player.level + 1;
    enemy.stats = {
        hp: 100 + player.level * 20,
        attack: 10 + player.level * 5,
        defense: 5 + player.level * 2
    };
    enemy.currentHp = enemy.stats.hp;
    updateHpBars();
}

function startBattle() {
    loadPlayer();
    document.getElementById('menu').style.display = 'none';
    document.getElementById('arena').style.display = 'block';
    generateEnemy();
    document.getElementById('battleLog').innerHTML = '';
    battleLoop();
}

function battleLoop() {
    if (player.currentHp <= 0 || enemy.currentHp <= 0) {
        endBattle();
        return;
    }
    
    const isPlayerTurn = Math.random() < 0.5;
    
    if (isPlayerTurn) {
        playerAttack();
    } else {
        enemyAttack();
    }
    
    setTimeout(battleLoop, 800);
}

function playerAttack() {
    const damage = player.stats.attack - enemy.stats.defense;
    enemy.currentHp = Math.max(0, enemy.currentHp - damage);
    updateHpBars();
    
    document.getElementById('enemyHp').classList.add('hit');
    document.getElementById('battleLog').innerHTML += 
        `<div class="log">Игрок нанес ${damage} урона!</div>`;
    
    setTimeout(() => document.getElementById('enemyHp').classList.remove('hit'), 300);
}

function enemyAttack() {
    const damage = enemy.stats.attack - player.stats.defense;
    player.currentHp = Math.max(0, player.currentHp - damage);
    updateHpBars();
    
    document.getElementById('playerHp').classList.add('hit');
    document.getElementById('battleLog').innerHTML += 
        `<div class="log">Противник нанес ${damage} урона!</div>`;
    
    setTimeout(() => document.getElementById('playerHp').classList.remove('hit'), 300);
}

function endBattle() {
    if (enemy.currentHp <= 0) {
        gainExp(enemy.level * 15);
        document.getElementById('battleLog').innerHTML += 
            `<div class="win">Победа!</div>`;
    } else {
        document.getElementById('battleLog').innerHTML += 
            `<div class="lose">Поражение...</div>`;
    }
    
    setTimeout(() => {
        document.getElementById('arena').style.display = 'none';
        document.getElementById('menu').style.display = 'block';
    }, 2000);
}

function gainExp(exp) {
    player.exp += exp;
    
    while (player.exp >= player.maxExp) {
        player.level++;
        player.exp -= player.maxExp;
        player.maxExp = player.level * 100;
        
        player.stats.hp += 20;
        player.stats.attack += 5;
        player.stats.defense += 3;
        player.currentHp = player.stats.hp;
    }
    
    savePlayer();
}

function showStats() {
    document.getElementById('menu').style.display = 'none';
    document.getElementById('stats').style.display = 'block';
    
    document.getElementById('statsContent').innerHTML = `
        <div>Уровень: ${player.level}</div>
        <div>Опыт: ${player.exp}/${player.maxExp}</div>
        <div>Здоровье: ${player.stats.hp}</div>
        <div>Атака: ${player.stats.attack}</div>
        <div>Защита: ${player.stats.defense}</div>
    `;
}

function backToMenu() {
    document.getElementById('stats').style.display = 'none';
    document.getElementById('menu').style.display = 'block';
}

// Загрузка сохранения при загрузке страницы
loadPlayer();
</script>

</body>
</html>
