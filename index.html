<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chaos Fighters</title>
    <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: #282c34;
            color: white;
            font-family: Arial, sans-serif;
        }
        #menu {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            padding: 20px;
            background: rgba(0,0,0,0.8);
            border-radius: 8px;
        }
        #menu button {
            padding: 10px 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        #battleContainer {
            position: relative;
            width: 600px;
            height: 400px;
        }
        #battleCanvas {
            border: 1px solid white;
        }
        #interface {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 10px;
            background: rgba(0,0,0,0.5);
        }
        #log {
            position: absolute;
            top: 0;
            right: 0;
            width: 300px;
            height: 400px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(0,0,0,0.5);
        }
        #upgradeMenu {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            padding: 20px;
            border-radius: 8px;
        }
        .log-entry {
            margin: 5px 0;
        }
    </style>
</head>
<body>
<div id="menu">
    <h1>Chaos Fighters</h1>
    <button onclick="startGame()">Начать игру</button>
    <button onclick="showUpgrades()">Прокачка</button>
</div>

<div id="battleContainer">
    <canvas id="battleCanvas" width="600" height="400"></canvas>
    <div id="interface">
        <div>Жизни: <span id="playerHp">100</span></div>
        <div>Броня: <span id="playerArmor">10</span></div>
        <div>Опыт: <span id="playerExp">0</span></div>
    </div>
    <div id="log"></div>
</div>

<div id="upgradeMenu">
    <h2>Прокачка</h2>
    <button onclick="upgradeHealth()">+10 к здоровью (100 exp)</button>
    <button onclick="upgradeArmor()">+2 к броне (100 exp)</button>
    <button onclick="closeUpgrade()">Закрыть</button>
</div>

<script>
const canvas = document.getElementById('battleCanvas');
const ctx = canvas.getContext('2d');

let player = {
    x: 50,
    y: 200,
    width: 50,
    height: 50,
    hp: 100,
    maxHp: 100,
    armor: 10,
    exp: 0,
    attackPower: 15,
    speed: 1.5
};

let bot = {
    x: 550,
    y: 200,
    width: 50,
    height: 50,
    hp: 80,
    attackPower: 10,
    speed: 1.2
};

let battleRunning = false;
let particles = [];
let log = [];

function updateLog(message) {
    log.push(message);
    document.getElementById('log').innerHTML = log.slice(-10).map((msg, i) => 
        `<div class="log-entry">${msg}</div>`
    ).join('');
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Рисуем частицы
    particles.forEach(p => {
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.radius, 0, Math.PI*2);
        ctx.fillStyle = `rgba(255, 0, 0, ${p.alpha})`;
        ctx.fill();
        p.radius -= 0.5;
        p.alpha -= 0.1;
    });
    particles = particles.filter(p => p.radius > 0);

    // Игрок
    ctx.fillStyle = '#1890ff';
    ctx.fillRect(player.x, player.y, player.width, player.height);

    // Бот
    ctx.fillStyle = '#f5222d';
    ctx.fillRect(bot.x, bot.y, bot.width, bot.height);
}

function moveEntities() {
    // Движение игрока
    if (player.x < bot.x) player.x += player.speed;
    else player.x -= player.speed;

    // Движение бота
    if (bot.x > player.x) bot.x -= bot.speed;
    else bot.x += bot.speed;
}

function checkCollision() {
    return (player.x < bot.x + bot.width &&
            player.x + player.width > bot.x &&
            player.y < bot.y + bot.height &&
            player.y + player.height > bot.y);
}

function attack() {
    if (!checkCollision()) return;

    // Атака игрока
    if (Math.random() < 0.15) {
        let damage = player.attackPower - bot.armor;
        bot.hp -= damage > 0 ? damage : 1;
        particles.push({
            x: bot.x + 25,
            y: bot.y + 25,
            radius: 15,
            alpha: 0.7
        });
        updateLog(`Вы нанесли ${damage} урона`);
    }

    // Атака бота
    if (Math.random() < 0.1) {
        let damage = bot.attackPower - player.armor;
        player.hp -= damage > 0 ? damage : 1;
        particles.push({
            x: player.x + 25,
            y: player.y + 25,
            radius: 15,
            alpha: 0.7
        });
        updateLog(`Бот нанес ${damage} урона`);
    }
}

function battleLoop() {
    if (!battleRunning) return;

    moveEntities();
    attack();
    
    draw();
    
    if (player.hp <= 0) endBattle(false);
    else if (bot.hp <= 0) endBattle(true);
    
    requestAnimationFrame(battleLoop);
}

function startGame() {
    resetBattle();
    document.getElementById('menu').style.display = 'none';
    battleRunning = true;
    requestAnimationFrame(battleLoop);
}

function resetBattle() {
    player.hp = player.maxHp;
    bot.hp = 80;
    player.x = 50;
    bot.x = 550;
    log = [];
    particles = [];
    updateInterface();
}

function endBattle(won) {
    battleRunning = false;
    if (won) {
        player.exp += 100;
        updateLog('Победа! Получено 100 опыта.');
        showUpgrades();
    } else {
        updateLog('Поражение!');
    }
    resetBattle();
}

function showUpgrades() {
    document.getElementById('upgradeMenu').style.display = 'flex';
}

function closeUpgrade() {
    document.getElementById('upgradeMenu').style.display = 'none';
}

function upgradeHealth() {
    if (player.exp >= 100) {
        player.maxHp += 10;
        player.exp -= 100;
        updateInterface();
        closeUpgrade();
    }
}

function upgradeArmor() {
    if (player.exp >= 100) {
        player.armor += 2;
        player.exp -= 100;
        updateInterface();
        closeUpgrade();
    }
}

function updateInterface() {
    document.getElementById('playerHp').textContent = player.hp;
    document.getElementById('playerArmor').textContent = player.armor;
    document.getElementById('playerExp').textContent = player.exp;
}

// Инициализация
updateInterface();
</script>
</body>
</html>
