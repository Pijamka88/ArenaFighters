<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flying Cows Hunt</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            touch-action: none;
            font-family: 'Arial Black', sans-serif;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        #gameCanvas {
            border: 2px solid #444;
        }

        #menu {
            position: absolute;
            text-align: center;
            background: rgba(0,0,0,0.9);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #fff;
            z-index: 2;
        }

        .btn {
            padding: 15px 30px;
            font-size: 18px;
            background: #4CAF50;
            border: none;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: scale(1.1);
        }

        .crosshair {
            position: absolute;
            width: 32px;
            height: 32px;
            pointer-events: none;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="%23ff0000" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-12.5c-2.49 0-4.5 2.01-4.5 4.5s2.01 4.5 4.5 4.5 4.5-2.01 4.5-4.5-2.01-4.5-4.5-4.5zm0 7c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>') center/contain no-repeat;
            filter: drop-shadow(0 0 3px rgba(255,0,0,0.5));
        }

        #hud {
            position: absolute;
            width: 100%;
            top: 10px;
            color: white;
            font-size: 20px;
            text-shadow: 2px 2px 2px black;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            pointer-events: none;
        }

        #bottomHUD {
            position: absolute;
            bottom: 10px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            box-sizing: border-box;
        }

        #pistol {
            width: 60px;
            height: 40px;
            background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo4MjRGRTg0QzA3NjgxMUUzQkZGNDhENEJFQjM2OTcyRiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo4MjRGRTg0RDA3NjgxMUUzQkZGNDhENEJFQjM2OTcyRiI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjgyNEZFODRBMDc2ODExRTNCRkY0OEQ0QkVCMzY5NzJGIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjgyNEZFODRCMDc2ODExRTNCRkY0OEQ0QkVCMzY5NzJGIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+Y7ZvUAAAA2FJREFUeNrkmD9rFEEUx9+sJkYRsUEUxIJgYxQh/4CNjVjYiI2FjZ0i2FjY2PgJxMpKxMbCQkSwEQsLQbARxEIUjCCCiEaD5nd5g7y9ndm9vdu9BPx4zN7Ozsxv3r55783sRlEUmY+0yLwkywAygAzgHwM4D8wC34E3wFZgKzADfAQe5LkZ3wDsA24D24Fp4BpwHjgJXAZ2AWeBq8B4XgDAqGj+JnAU+ABcAq4Dp4CjwBhwB9gHnMgLwGZgD/AMeA3cBfYDu4HnwHNgF3APeJQXgC/AQ2AC2A7sBx4Ar4B9wE7gEXA/LwBzwF1gP7ANOAQ8AV4CB4BdwH3gSV4ApoCbwDFgDDgKPAVeAEeAceAm8DQvANPAdeAEsBE4DjwDXgHHgY3ANeBZXgDmgZvACWATcBJ4DrwGTgKbgcvAi7wALAC3gFPAZuAU8BJ4A5wGtgAXgFd5AVgE7gCnga3AaeA18BY4A2wDzgNv8gJQBu4CZ4DtwB/AW+BPYCdwDnibF4Bl4B5wFtgBnAXeAe+Bc8AO4G/gfV4AKsB94CywE/gL+AB8BP4CdgN/Ah/yAlADHgB/A7uAv4FPwCfgH2APcBb4nBeAOlAGzgB7gX+Az8Bn4AKwFzgNfMkLQAN4CFwE9gEXgC/AF+ASsB84BXzNC0ATeARcAvYDl4CvwFfgMnAAOAl8ywtAG3gMXAYOAleAb8A34ApwEDgOfMsLQAd4AlwFDgHXgO/ANHANOAz8AczkBaALPAWuAUeA68AMMAPcAI4Cx4CZvABEwFPgOnAMuAHMArPADeA4cAyYzQtAD3gG3ABOADeBOWAeuAmcBE4A3/MCEAPlBMQp4BYwDywAt4HTwClgNi8AMfAcuA2cAe4A88ACcAc4C5wB5vICkAAvgDvAWeAusAAsAneBc8BZYD4vAAnwErgLnAPuAYvAEnAPOA+cAxbyApAAr4D7wHngPrAELAMl4DxwAVjMC0ACvAYeABeBB8AysAI8AC4CF4GlvAAkwBvgIXAJeAisAKvAQ+AScBlYzgtAArwFHgGXgcfAKlABHgNXgMvASl4AEuAd8Bi4AjwBVoEq8AS4ClwB1vICEAPvgSfAVeApUANqwDPgGnAVqOcFIAY+AE+Ba8AzoA7UgefAdeAa0MgLQAx8BJ4B14EXQAOoAy+BG8B1oJkXgBj4BLwAbgKvgCbQAF4Bt4CbQCsvADHwGXgJ3AZeAy2gCbwB7gC3gHZeAGLgC/AauAO8BdpAC3gL3AXuAp28AMTAV+ANcA94B3SANvAOuA/cB7p5AYiBb8Bb4D7wHugCHeA98AB4AES5AYiB78A74AHwAYiALvAReAg8BKLcAMTADPAR+AR8BmKgB3wGHgGPgThjzR8BBgCQvY5R/5w4CgAAAABJRU5ErkJggG==') center/contain no-repeat;
        }
    </style>
</head>
<body>
    <div id="menu">
        <h1 style="color: #4CAF50; margin: 0 0 20px 0;">üêÆ FLYING COWS HUNT ü¶á</h1>
        <button class="btn" id="startBtn">Start Game</button>
        <button class="btn" id="howToBtn">How to Play</button>
        <button class="btn" id="highScoreBtn">High Score: <span id="highScore">0</span></button>
    </div>

    <div id="hud">
        <div>Score: <span id="score">0</span></div>
        <div>Lives: <span id="lives">3</span></div>
    </div>

    <div id="bottomHUD">
        <div style="display: flex; gap: 15px;">
            <div>Ammo: <span id="ammo">10</span></div>
            <div>Hits: <span id="hits">0</span></div>
            <div>Miss: <span id="miss">0</span></div>
        </div>
        <button id="pauseBtn" style="padding: 8px 15px;">‚è∏</button>
        <div id="pistol"></div>
    </div>

    <canvas id="gameCanvas"></canvas>
    <div class="crosshair"></div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let animationFrameId;
        let isPaused = false;

        // Game state
        const gameState = {
            cows: [],
            score: 0,
            ammo: 10,
            lives: 3,
            hits: 0,
            miss: 0,
            isPlaying: false,
            crosshair: { x: 0, y: 0 },
            lastSpawn: 0,
            gameTime: 60000,
            reloading: false,
            particles: [],
            highScore: localStorage.getItem('highScore') || 0
        };

        // Cow types
        class BasicCow {
            constructor() {
                this.x = Math.random() < 0.5 ? -80 : canvas.width + 80;
                this.y = Math.random() * (canvas.height - 150);
                this.speed = (Math.random() * 2) + 1;
                this.direction = this.x < 0 ? 1 : -1;
                this.width = 60;
                this.height = 40;
                this.active = true;
                this.type = 'basic';
            }

            update() {
                this.x += this.speed * this.direction;
            }
        }

        class ZigzagCow extends BasicCow {
            constructor() {
                super();
                this.type = 'zigzag';
                this.angle = 0;
            }

            update() {
                super.update();
                this.angle += 0.1;
                this.y += Math.sin(this.angle) * 2;
            }
        }

        // Game initialization
        function initCanvas() {
            canvas.width = Math.min(window.innerWidth, 800);
            canvas.height = Math.min(window.innerHeight, 600);
        }
        initCanvas();
        window.addEventListener('resize', initCanvas);

        // Crosshair and input
        document.addEventListener('mousemove', e => {
            gameState.crosshair.x = e.clientX;
            gameState.crosshair.y = e.clientY;
        });

        document.addEventListener('touchmove', e => {
            e.preventDefault();
            gameState.crosshair.x = e.touches[0].clientX;
            gameState.crosshair.y = e.touches[0].clientY;
        }, { passive: false });

        // Drawing functions
        function drawBackground() {
            // Sky
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(1, '#98FB98');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Trees
            ctx.fillStyle = '#2d5a27';
            for(let i = 0; i < 8; i++) {
                const x = Math.random() * canvas.width;
                ctx.fillRect(x, canvas.height - 120, 30, 120);
                ctx.beginPath();
                ctx.arc(x + 15, canvas.height - 140, 40, 0, Math.PI * 2);
                ctx.fillStyle = '#228B22';
                ctx.fill();
            }

            // Grass
            ctx.fillStyle = '#2d5a27';
            ctx.fillRect(0, canvas.height - 50, canvas.width, 50);
        }

        function drawCow(cow) {
            ctx.fillStyle = '#FFF';
            ctx.fillRect(cow.x, cow.y, 50, 30);
            ctx.beginPath();
            ctx.arc(cow.x + 40, cow.y + 15, 15, 0, Math.PI * 2);
            ctx.fillStyle = '#F0F0F0';
            ctx.fill();
        }

        // Game logic
        function spawnCow() {
            if(gameState.cows.length >= 4) return;
            
            const types = [BasicCow, ZigzagCow];
            const CowType = types[Math.floor(Math.random() * types.length)];
            gameState.cows.push(new CowType());
        }

        function checkCollision(cow) {
            const rect = canvas.getBoundingClientRect();
            const cx = gameState.crosshair.x - rect.left;
            const cy = gameState.crosshair.y - rect.top;
            
            return cx > cow.x + 10 && cx < cow.x + cow.width - 10 &&
                   cy > cow.y + 10 && cy < cow.y + cow.height - 10;
        }

        function gameLoop(timestamp) {
            if(!gameState.isPlaying || isPaused) return;

            // Spawn cows
            if(timestamp - gameState.lastSpawn > 1500) {
                spawnCow();
                gameState.lastSpawn = timestamp;
            }

            // Update cows
            gameState.cows = gameState.cows.filter(cow => {
                cow.update();
                if(cow.x < -100 || cow.x > canvas.width + 100) {
                    gameState.lives--;
                    return false;
                }
                return true;
            });

            // Update HUD
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('ammo').textContent = gameState.ammo;
            document.getElementById('lives').textContent = gameState.lives;
            document.getElementById('hits').textContent = gameState.hits;
            document.getElementById('miss').textContent = gameState.miss;

            // Check game over
            if(gameState.lives <= 0) {
                endGame();
                return;
            }

            // Drawing
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBackground();
            gameState.cows.forEach(drawCow);

            animationFrameId = requestAnimationFrame(gameLoop);
        }

        // Game controls
        function handleShoot() {
            if(!gameState.isPlaying || gameState.ammo <= 0) return;

            gameState.ammo--;
            let hit = false;
            
            gameState.cows.forEach(cow => {
                if(checkCollision(cow)) {
                    gameState.score += cow.type === 'basic' ? 20 : 30;
                    gameState.hits++;
                    hit = true;
                    cow.active = false;
                }
            });

            if(!hit) gameState.miss++;
        }

        function endGame() {
            gameState.isPlaying = false;
            cancelAnimationFrame(animationFrameId);
            
            if(gameState.score > gameState.highScore) {
                gameState.highScore = gameState.score;
                localStorage.setItem('highScore', gameState.highScore);
            }
            
            document.getElementById('menu').style.display = 'block';
            document.getElementById('highScore').textContent = gameState.highScore;
        }

        // Event listeners
        document.addEventListener('mousedown', handleShoot);
        document.addEventListener('touchstart', handleShoot);

        document.getElementById('startBtn').addEventListener('click', () => {
            document.getElementById('menu').style.display = 'none';
            gameState.isPlaying = true;
            gameState.score = 0;
            gameState.lives = 3;
            gameState.ammo = 10;
            gameState.hits = 0;
            gameState.miss = 0;
            gameState.cows = [];
            gameLoop(0);
        });

        document.getElementById('pauseBtn').addEventListener('click', () => {
            isPaused = !isPaused;
            if(!isPaused) gameLoop(0);
        });

        document.getElementById('howToBtn').addEventListener('click', () => {
            alert(`HOW TO PLAY:
- Shoot flying cows with your crosshair
- You have 3 lives and 10 bullets
- Different cow types give different points
- Avoid letting cows escape behind trees
- Game ends after 60 seconds or 0 lives`);
        });

        // Init
        document.getElementById('highScore').textContent = gameState.highScore;
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
    </script>
</body>
</html>