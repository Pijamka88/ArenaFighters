<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mad Cow Hunt</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --main-color: #FF6B6B;
            --secondary-color: #4ECDC4;
            --dark-bg: #2D3436;
        }

        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            touch-action: none;
            font-family: 'Luckiest Guy', cursive;
            background: var(--dark-bg);
            color: white;
        }

        #gameCanvas {
            position: absolute;
            top: 0;
            left: 0;
        }

        .menu {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            background: rgba(45, 52, 54, 0.95);
            padding: 2rem;
            border-radius: 20px;
            border: 3px solid var(--main-color);
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }

        .menu-title {
            font-size: 3rem;
            color: var(--main-color);
            margin: 0 0 2rem 0;
            text-shadow: 3px 3px 0 rgba(0,0,0,0.3);
        }

        .btn {
            display: block;
            width: 200px;
            padding: 1rem;
            margin: 1rem auto;
            font-size: 1.2rem;
            background: var(--secondary-color);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: scale(1.05);
        }

        .hud {
            position: absolute;
            padding: 1rem;
            background: rgba(0,0,0,0.7);
            border-radius: 10px;
        }

        #topHud {
            top: 10px;
            left: 10px;
            font-size: 1.5rem;
        }

        #bottomHud {
            bottom: 10px;
            width: 90%;
            left: 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .crosshair {
            position: absolute;
            width: 32px;
            height: 32px;
            pointer-events: none;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path fill="%23FF6B6B" d="M16 2C8.3 2 2 8.3 2 16s6.3 14 14 14 14-6.3 14-14S23.7 2 16 2zm0 22c-4.4 0-8-3.6-8-8s3.6-8 8-8 8 3.6 8 8-3.6 8-8 8z"/><path fill="%23FF6B6B" d="M16 11c-2.8 0-5 2.2-5 5s2.2 5 5 5 5-2.2 5-5-2.2-5-5-5z"/></svg>');
            transform: translate(-16px, -16px);
        }

        #pistol {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 3rem;
            filter: drop-shadow(0 0 5px rgba(0,0,0,0.5));
        }

        #pauseBtn {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 0.5rem 1rem;
        }
    </style>
</head>
<body>
    <div id="mainMenu" class="menu">
        <h1 class="menu-title">üêÆ MAD COW HUNT üî´</h1>
        <button class="btn" id="startBtn">START GAME</button>
        <button class="btn" id="howToBtn">HOW TO PLAY</button>
        <button class="btn" id="highScoreBtn">HIGH SCORES</button>
    </div>

    <div id="highScoreMenu" class="menu" style="display: none;">
        <h1 class="menu-title">üèÜ HIGH SCORES</h1>
        <div id="scoresList"></div>
        <button class="btn" onclick="showMenu('mainMenu')">BACK</button>
    </div>

    <div id="topHud" class="hud">
        SCORE: <span id="score">0</span>
    </div>

    <div id="bottomHud" class="hud">
        <div>AMMO: <span id="ammo">10</span></div>
        <div>HITS: <span id="hits">0</span></div>
        <div>MISS: <span id="miss">0</span></div>
    </div>

    <button class="btn" id="pauseBtn">‚è∏ PAUSE</button>
    <div id="pistol">üî´</div>
    <canvas id="gameCanvas"></canvas>
    <div class="crosshair"></div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let gameState = null;
        let highScores = JSON.parse(localStorage.getItem('highScores')) || [];

        class FlyingCow {
            constructor(type) {
                this.types = {
                    basic: { speed: 2, score: 100, color: '#FF6B6B', size: 50 },
                    rare: { speed: 3.5, score: 250, color: '#4ECDC4', size: 40 },
                    angry: { speed: 4, score: 500, color: '#FF5252', size: 60 }
                };
                this.type = type || this.randomType();
                this.config = this.types[this.type];
                
                this.x = Math.random() < 0.5 ? -100 : canvas.width + 100;
                this.y = Math.random() * canvas.height * 0.6;
                this.angle = 0;
                this.amplitude = Math.random() * 50 + 30;
                this.speed = this.config.speed * (Math.random() * 0.4 + 0.8);
                this.direction = this.x < 0 ? 1 : -1;
                this.health = 1;
                this.frame = 0;
            }

            randomType() {
                const rand = Math.random();
                return rand < 0.7 ? 'basic' : rand < 0.9 ? 'rare' : 'angry';
            }

            update() {
                this.x += this.speed * this.direction;
                this.y += Math.sin(this.angle) * this.amplitude * 0.1;
                this.angle += 0.1;
                this.frame += 0.1;
            }

            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.scale(this.direction, 1);

                // Body
                ctx.fillStyle = this.config.color;
                ctx.beginPath();
                ctx.ellipse(0, 0, this.config.size/2, this.config.size/3, 0, 0, Math.PI * 2);
                ctx.fill();

                // Wings
                ctx.strokeStyle = 'rgba(255,255,255,0.8)';
                ctx.lineWidth = 4;
                ctx.beginPath();
                ctx.arc(-10, -5, 15 + Math.sin(this.frame)*5, Math.PI*0.5, Math.PI*1.5);
                ctx.stroke();

                ctx.restore();
            }
        }

        function initGame() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            gameState = {
                cows: [],
                score: 0,
                ammo: 10,
                hits: 0,
                miss: 0,
                isPlaying: false,
                isPaused: false,
                crosshair: { x: 0, y: 0 },
                lastShot: 0,
                reloadTime: 1000,
                particles: []
            };
        }

        function gameLoop(timestamp) {
            if (!gameState.isPlaying || gameState.isPaused) return;

            // Spawn cows
            if (Math.random() < 0.03 && gameState.cows.length < 15) {
                gameState.cows.push(new FlyingCow());
            }

            // Update game objects
            gameState.cows = gameState.cows.filter(cow => {
                cow.update();
                return cow.x > -150 && cow.x < canvas.width + 150;
            });

            // Update HUD
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('ammo').textContent = gameState.ammo;
            document.getElementById('hits').textContent = gameState.hits;
            document.getElementById('miss').textContent = gameState.miss;

            // Clear canvas
            ctx.fillStyle = '#2D3436';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw cows
            gameState.cows.forEach(cow => cow.draw());

            requestAnimationFrame(gameLoop);
        }

        function handleShoot(e) {
            if (!gameState.isPlaying || gameState.isPaused) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX || e.touches[0].clientX) - rect.left;
            const y = (e.clientY || e.touches[0].clientY) - rect.top;

            if (gameState.ammo > 0) {
                gameState.ammo--;
                let hit = false;

                gameState.cows.forEach(cow => {
                    const dx = x - cow.x;
                    const dy = y - cow.y;
                    if (Math.sqrt(dx*dx + dy*dy) < cow.config.size) {
                        gameState.score += cow.config.score;
                        gameState.hits++;
                        hit = true;
                        cow.health = 0;
                    }
                });

                hit ? playSound('hit') : playSound('miss');
                if (!hit) gameState.miss++;
            }
        }

        function playSound(type) {
            const sounds = {
                hit: new Audio('data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU'),
                miss: new Audio('data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU'),
                reload: new Audio('data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU')
            };
            sounds[type].play();
        }

        function showMenu(menuId) {
            document.querySelectorAll('.menu').forEach(m => m.style.display = 'none');
            document.getElementById(menuId).style.display = 'block';
        }

        // Event Listeners
        canvas.addEventListener('mousedown', handleShoot);
        canvas.addEventListener('touchstart', handleShoot);

        document.getElementById('startBtn').addEventListener('click', () => {
            showMenu(null);
            initGame();
            gameState.isPlaying = true;
            gameLoop();
            
            // Game timer
            setTimeout(() => {
                gameState.isPlaying = false;
                if (gameState.score > Math.min(...highScores)) {
                    highScores.push(gameState.score);
                    highScores.sort((a,b) => b - a).splice(5);
                    localStorage.setItem('highScores', JSON.stringify(highScores));
                }
                showMenu('mainMenu');
            }, 60000);
        });

        document.getElementById('highScoreBtn').addEventListener('click', () => {
            const scoresList = document.getElementById('scoresList');
            scoresList.innerHTML = highScores.sort((a,b) => b - a)
                .map((score,i) => `<div>${i+1}. ${score}</div>`)
                .join('');
            showMenu('highScoreMenu');
        });

        document.getElementById('howToBtn').addEventListener('click', () => {
            alert(`HOW TO PLAY:
- Shoot flying cows with your crosshair
- Different cows give different points
- Reload by waiting 1 second
- Game lasts 60 seconds
- Try to get in top 5 high scores!`);
        });

        document.getElementById('pauseBtn').addEventListener('click', () => {
            gameState.isPaused = !gameState.isPaused;
            document.getElementById('pauseBtn').textContent = gameState.isPaused ? '‚ñ∂ PLAY' : '‚è∏ PAUSE';
        });

        // Init
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
        initGame();
        showMenu('mainMenu');

        // Crosshair movement
        document.addEventListener('mousemove', e => {
            document.querySelector('.crosshair').style.transform = 
                `translate(${e.clientX - 16}px, ${e.clientY - 16}px)`;
        });

        document.addEventListener('touchmove', e => {
            e.preventDefault();
            const touch = e.touches[0];
            document.querySelector('.crosshair').style.transform = 
                `translate(${touch.clientX - 16}px, ${touch.clientY - 16}px)`;
        }, { passive: false });
    </script>
</body>
</html>