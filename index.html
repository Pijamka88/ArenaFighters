<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ö–æ—Å–º–∏—á–µ—Å–∫–∏–µ –ö–æ—Ä–æ–≤—ã</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --main-color: #FF6B6B;
            --accent-color: #4ECDC4;
            --dark-bg: #2D3047;
            --light-text: #FFE66D;
        }

        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            touch-action: none;
            font-family: 'Rubik', sans-serif;
            background: var(--dark-bg);
            color: white;
            text-align: center;
        }

        #gameCanvas {
            position: absolute;
            top: 0;
            left: 0;
        }

        .hud {
            position: fixed;
            top: 15px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            box-sizing: border-box;
            pointer-events: none;
        }

        .hud-item {
            background: rgba(0,0,0,0.7);
            padding: 10px 20px;
            border-radius: 15px;
            border: 2px solid var(--light-text);
            font-size: 1.2em;
            margin: 0 auto;
        }

        #menu {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(45,48,71,0.95);
            padding: 30px 50px;
            border-radius: 25px;
            border: 2px solid var(--light-text);
            z-index: 100;
            width: 90%;
            max-width: 500px;
        }

        .menu-title {
            font-size: 2em;
            color: var(--light-text);
            margin: 0 0 20px 0;
        }

        .btn {
            padding: 12px 24px;
            font-size: 1em;
            background: linear-gradient(45deg, var(--main-color), var(--accent-color));
            border: none;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            margin: 8px;
            display: block;
            width: 100%;
        }

        .crosshair {
            position: absolute;
            width: 32px;
            height: 32px;
            pointer-events: none;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="%234ECDC4" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-12.5c-2.49 0-4.5 2.01-4.5 4.5s2.01 4.5 4.5 4.5 4.5-2.01 4.5-4.5-2.01-4.5-4.5-4.5zm0 7c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>');
            background-size: contain;
        }

        #leaderboard {
            max-height: 200px;
            overflow-y: auto;
            margin: 15px 0;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="menu">
        <h1 class="menu-title">üêÆ –ö–û–°–ú–ò–ß–ï–°–ö–ò–ï –ö–û–†–û–í–´ üöÄ</h1>
        <div class="hud-item" style="margin-bottom:15px;">–†–µ–∫–æ—Ä–¥: <span id="highScore">0</span></div>
        <button class="btn" id="startBtn">–ò–ì–†–ê–¢–¨</button>
        <button class="btn" id="howToBtn">–ü–†–ê–í–ò–õ–ê</button>
        <button class="btn" id="leaderboardBtn">–¢–û–ü-10</button>
    </div>

    <div class="hud">
        <div class="hud-item">
            –û—á–∫–∏: <span id="score">0</span> | –ñ–∏–∑–Ω–∏: <span id="lives">3</span>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let gameState = {
            targets: [],
            score: 0,
            ammo: 10,
            lives: 3,
            misses: 0,
            isPlaying: false,
            crosshair: { x: 0, y: 0 },
            lastSpawn: 0,
            gameTime: 60000,
            reloading: false,
            leaderboard: JSON.parse(localStorage.getItem('leaderboard')) || []
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.getElementById('highScore').textContent = Math.max(...gameState.leaderboard, 0);
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        const crosshair = document.createElement('div');
        crosshair.className = 'crosshair';
        document.body.appendChild(crosshair);

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞
        canvas.addEventListener('mousemove', updateCrosshair);
        canvas.addEventListener('touchmove', e => {
            e.preventDefault();
            updateCrosshair(e.touches[0]);
        }, { passive: false });

        function updateCrosshair(e) {
            const rect = canvas.getBoundingClientRect();
            gameState.crosshair.x = e.clientX - rect.left;
            gameState.crosshair.y = e.clientY - rect.top;
            crosshair.style.transform = `translate(${e.clientX - 16}px, ${e.clientY - 16}px)`;
        }

        // –ò–≥—Ä–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã
        function createCow() {
            return {
                x: Math.random() < 0.5 ? -80 : canvas.width + 80,
                y: Math.random() * (canvas.height * 0.6),
                speed: 2 + Math.random() * 3,
                direction: Math.random() < 0.5 ? 1 : -1,
                size: 50,
                angle: 0,
                wingPhase: Math.random() * Math.PI * 2
            };
        }

        function drawTree(x, height) {
            ctx.fillStyle = '#5C4033';
            ctx.fillRect(x - 10, canvas.height - height, 20, height - 40);
            ctx.beginPath();
            ctx.arc(x, canvas.height - height - 20, 40, 0, Math.PI * 2);
            ctx.fillStyle = '#228B22';
            ctx.fill();
        }

        function drawCow(cow) {
            ctx.save();
            ctx.translate(cow.x, cow.y);
            
            // –¢–µ–ª–æ
            ctx.strokeStyle = '#FFF';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.ellipse(0, 0, cow.size/2, cow.size/3, cow.angle, 0, Math.PI * 2);
            ctx.stroke();
            
            // –ö—Ä—ã–ª—å—è
            ctx.beginPath();
            const wingY = Math.sin(cow.wingPhase) * 15;
            ctx.moveTo(-15, 0);
            ctx.lineTo(-35, wingY);
            ctx.moveTo(15, 0);
            ctx.lineTo(35, wingY);
            ctx.stroke();
            
            ctx.restore();
        }

        // –õ–æ–≥–∏–∫–∞ –∏–≥—Ä—ã
        function checkHit(cow) {
            const dx = gameState.crosshair.x - cow.x;
            const dy = gameState.crosshair.y - cow.y;
            return Math.hypot(dx, dy) < cow.size/2;
        }

        function gameLoop(timestamp) {
            if (!gameState.isPlaying) return;

            // –°–ø–∞–≤–Ω –∫–æ—Ä–æ–≤
            if (timestamp - gameState.lastSpawn > 1200 && gameState.targets.length < 8) {
                gameState.targets.push(createCow());
                gameState.lastSpawn = timestamp;
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ—Ä–æ–≤
            gameState.targets = gameState.targets.filter(cow => {
                cow.x += cow.speed * cow.direction;
                cow.angle += 0.02 * cow.direction;
                cow.wingPhase += 0.1;
                return cow.x > -100 && cow.x < canvas.width + 100;
            });

            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // –î–µ—Ä–µ–≤—å—è
            for(let i = 0; i < 6; i++) {
                drawTree(canvas.width * (i/5), 120 + Math.random() * 80);
            }
            
            // –ö–æ—Ä–æ–≤—ã
            gameState.targets.forEach(drawCow);

            requestAnimationFrame(gameLoop);
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã—Å—Ç—Ä–µ–ª–∞
        function handleShoot() {
            if (!gameState.isPlaying || gameState.reloading) return;

            let hit = false;
            gameState.targets.forEach((cow, i) => {
                if (checkHit(cow)) {
                    gameState.score += 100;
                    gameState.targets.splice(i, 1);
                    hit = true;
                }
            });

            if (!hit) {
                gameState.misses++;
                if (gameState.misses % 3 === 0) {
                    gameState.lives--;
                    document.getElementById('lives').textContent = gameState.lives;
                    if (gameState.lives <= 0) endGame();
                }
            }

            document.getElementById('score').textContent = gameState.score;
        }

        function endGame() {
            gameState.isPlaying = false;
            updateLeaderboard();
            document.getElementById('menu').style.display = 'block';
            crosshair.style.display = 'none';
            alert(`–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –°—á–µ—Ç: ${gameState.score}`);
        }

        function updateLeaderboard() {
            gameState.leaderboard.push(gameState.score);
            gameState.leaderboard.sort((a,b) => b - a);
            gameState.leaderboard = [...new Set(gameState.leaderboard)].slice(0,10);
            localStorage.setItem('leaderboard', JSON.stringify(gameState.leaderboard));
        }

        // –°–æ–±—ã—Ç–∏—è
        document.getElementById('startBtn').addEventListener('click', () => {
            gameState = {
                ...gameState,
                targets: [],
                score: 0,
                lives: 3,
                misses: 0,
                isPlaying: true
            };
            document.getElementById('menu').style.display = 'none';
            crosshair.style.display = 'block';
            document.getElementById('lives').textContent = '3';
            document.getElementById('score').textContent = '0';
            setTimeout(endGame, 60000);
            requestAnimationFrame(gameLoop);
        });

        document.getElementById('howToBtn').addEventListener('click', () => {
            alert(`–ü–†–ê–í–ò–õ–ê –ò–ì–†–´:
1. –°—Ç—Ä–µ–ª—è–π—Ç–µ –≤ –ª–µ—Ç–∞—é—â–∏—Ö –∫–æ—Ä–æ–≤
2. –ö–∞–∂–¥—ã–µ 3 –ø—Ä–æ–º–∞—Ö–∞ –æ—Ç–Ω–∏–º–∞—é—Ç –∂–∏–∑–Ω—å
3. 10 –ª—É—á—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
4. –ò–≥—Ä–∞ –¥–ª–∏—Ç—Å—è 60 —Å–µ–∫—É–Ω–¥`);
        });

        document.getElementById('leaderboardBtn').addEventListener('click', () => {
            const list = gameState.leaderboard.map((s,i) => `${i+1}. ${s}`).join('\n');
            alert(`–¢–û–ü-10 –†–ï–ó–£–õ–¨–¢–ê–¢–û–í:\n${list || '–ü–æ–∫–∞ –Ω–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤'}`);
        });

        canvas.addEventListener('mousedown', handleShoot);
        canvas.addEventListener('touchstart', handleShoot);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
    </script>
</body>
</html>