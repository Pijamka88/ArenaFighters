<!DOCTYPE html>
<html>
<head>
    <title>Chaos Arena</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: 'Courier New', Courier, monospace;
            background: #1a1a1a;
            color: #f0e6d2;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .menu {
            text-align: center;
            margin-top: 50px;
        }

        .menu button {
            background: #4a3a2f;
            border: 2px solid #6b4e3d;
            color: #f0e6d2;
            padding: 15px 30px;
            margin: 10px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .menu button:hover {
            background: #6b4e3d;
        }

        .character {
            position: relative;
            width: 200px;
            height: 300px;
            background-size: cover;
            margin: 20px;
        }

        #player {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 300"><rect width="200" height="300" fill="%236b4e3d"/><path d="M100 50L150 100H50L100 50Z" fill="%23d4af37"/><rect x="75" y="100" width="50" height="150" fill="%238B4513"/></svg>');
        }

        #enemy {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 300"><rect width="200" height="300" fill="%234a3a2f"/><circle cx="100" cy="100" r="50" fill="%238B0000"/><rect x="75" y="150" width="50" height="100" fill="%232F4F4F"/></svg>');
        }

        .health-bar {
            position: absolute;
            top: 10px;
            width: 100%;
            text-align: center;
        }

        .progress {
            height: 20px;
            background: #6b4e3d;
            border: 2px solid #d4af37;
            margin: 10px 0;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: #d4af37;
            width: 100%;
            transition: width 0.3s;
        }

        .damage-text {
            position: absolute;
            font-size: 24px;
            color: red;
            text-shadow: 2px 2px 4px #000;
            animation: floatUp 1s ease-out;
        }

        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-50px); opacity: 0; }
        }

        .hidden { display: none; }
        .upgrade-btn { margin: 5px; padding: 10px 20px; }
        .game-over { font-size: 48px; color: red; text-align: center; margin-top: 100px; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Главное меню -->
        <div id="mainMenu" class="menu">
            <div id="playerStats">
                <div>Уровень: <span id="level">1</span></div>
                <div>Атака: <span id="attack">10</span></div>
                <div>Броня: <span id="armor">5</span></div>
                <div>Здоровье: <span id="health">100</span></div>
                <div>Опыт: <span id="experience">0</span>/100</div>
            </div>
            <button onclick="startBattle()">Начать бой</button>
            <button onclick="showUpgrades()">Прокачка</button>
            <button onclick="exitGame()">Выход</button>
        </div>

        <!-- Экран боя -->
        <div id="battleScreen" class="hidden">
            <div class="health-bar" id="playerHealthBar"><div class="progress"><div class="progress-fill" style="width: 100%"></div></div></div>
            <div class="health-bar" id="enemyHealthBar" style="left: 50%"><div class="progress"><div class="progress-fill" style="width: 100%"></div></div></div>
            
            <div style="display: flex; justify-content: space-between">
                <div class="character" id="player"></div>
                <div class="character" id="enemy"></div>
            </div>
        </div>

        <!-- Экран прокачки -->
        <div id="upgradeScreen" class="hidden menu">
            <div>Очков улучшений: <span id="upgradePoints">0</span></div>
            <button class="upgrade-btn" onclick="upgrade('attack')">Улучшить атаку</button>
            <button class="upgrade-btn" onclick="upgrade('armor')">Улучшить броню</button>
            <button class="upgrade-btn" onclick="upgrade('health')">Улучшить здоровье</button>
            <button onclick="backToMainMenu()">Назад</button>
        </div>

        <div id="gameOver" class="hidden game-over">Игрок проиграл!</div>
    </div>

    <script>
        let player = {
            level: 1,
            attack: 10,
            armor: 5,
            health: 100,
            maxHealth: 100,
            experience: 0,
            upgradePoints: 0
        };

        let enemy = {
            level: 1,
            attack: 8,
            armor: 3,
            health: 80,
            maxHealth: 80
        };

        let battleInterval;
        let damageQueue = [];

        // Загрузка сохранений
        if(localStorage.getItem('chaosArenaSave')) {
            Object.assign(player, JSON.parse(localStorage.getItem('chaosArenaSave')));
        }

        function updateStats() {
            document.getElementById('level').textContent = player.level;
            document.getElementById('attack').textContent = player.attack;
            document.getElementById('armor').textContent = player.armor;
            document.getElementById('health').textContent = player.health;
            document.getElementById('experience').textContent = `${player.experience}/100`;
            document.getElementById('upgradePoints').textContent = player.upgradePoints;
        }

        function showScreen(screen) {
            document.querySelectorAll('.container > div').forEach(div => div.classList.add('hidden'));
            document.getElementById(screen).classList.remove('hidden');
        }

        function startBattle() {
            player.health = player.maxHealth;
            generateEnemy();
            showScreen('battleScreen');
            updateHealthBars();
            battleInterval = setInterval(performBattleTurn, 2000);
        }

        function generateEnemy() {
            enemy.level = player.level;
            enemy.attack = 8 + (enemy.level - 1)*2;
            enemy.armor = 3 + (enemy.level - 1);
            enemy.maxHealth = 80 + (enemy.level - 1)*20;
            enemy.health = enemy.maxHealth;
        }

        function performBattleTurn() {
            // Атака игрока
            let damage = calculateDamage(player.attack, enemy.armor);
            enemy.health = Math.max(0, enemy.health - damage);
            showDamageText('enemy', damage);
            updateHealthBars();

            if(enemy.health <= 0) {
                endBattle(true);
                return;
            }

            // Атака врага
            setTimeout(() => {
                damage = calculateDamage(enemy.attack, player.armor);
                player.health = Math.max(0, player.health - damage);
                showDamageText('player', damage);
                updateHealthBars();

                if(player.health <= 0) {
                    endBattle(false);
                }
            }, 1000);
        }

        function calculateDamage(attack, armor) {
            return Math.max(1, Math.floor(attack * (1 - armor/100)));
        }

        function updateHealthBars() {
            document.querySelector('#playerHealthBar .progress-fill').style.width = 
                (player.health / player.maxHealth) * 100 + '%';
            document.querySelector('#enemyHealthBar .progress-fill').style.width = 
                (enemy.health / enemy.maxHealth) * 100 + '%';
        }

        function showDamageText(target, damage) {
            const container = document.getElementById(target);
            const text = document.createElement('div');
            text.className = 'damage-text';
            text.textContent = `-${damage}`;
            text.style.left = Math.random() * 100 + '%';
            container.appendChild(text);
            setTimeout(() => text.remove(), 1000);
        }

        function endBattle(victory) {
            clearInterval(battleInterval);
            if(victory) {
                const exp = 20 + enemy.level * 5;
                player.experience += exp;
                if(player.experience >= 100) {
                    player.level++;
                    player.upgradePoints++;
                    player.experience = 0;
                }
                updateStats();
                showScreen('mainMenu');
            } else {
                showScreen('gameOver');
                setTimeout(() => showScreen('mainMenu'), 3000);
            }
            saveGame();
        }

        function showUpgrades() {
            updateStats();
            showScreen('upgradeScreen');
        }

        function upgrade(stat) {
            if(player.upgradePoints > 0) {
                player.upgradePoints--;
                switch(stat) {
                    case 'attack': player.attack += 2; break;
                    case 'armor': player.armor += 1; break;
                    case 'health': player.maxHealth += 10; player.health = player.maxHealth; break;
                }
                updateStats();
                saveGame();
            }
        }

        function backToMainMenu() {
            showScreen('mainMenu');
        }

        function exitGame() {
            if(confirm('Выйти из игры?')) {
                // Добавьте здесь логику выхода, если нужно
            }
        }

        function saveGame() {
            localStorage.setItem('chaosArenaSave', JSON.stringify(player));
        }

        // Инициализация
        updateStats();
    </script>
</body>
</html>
