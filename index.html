<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ö–æ—Å–º–∏—á–µ—Å–∫–∏–µ –ö–æ—Ä–æ–≤—ã</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --main-color: #FF6B6B;
            --accent-color: #4ECDC4;
            --dark-bg: #2D3047;
            --light-text: #FFE66D;
        }

        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            touch-action: none;
            font-family: 'Rubik', sans-serif;
            background: var(--dark-bg);
            color: white;
            text-align: center;
        }

        #gameCanvas {
            position: absolute;
            top: 0;
            left: 0;
        }

        .hud {
            position: fixed;
            padding: 15px 25px;
            background: rgba(0,0,0,0.8);
            border-radius: 15px;
            border: 2px solid var(--light-text);
            box-shadow: 0 0 15px rgba(255,230,109,0.3);
            font-size: 1.2em;
        }

        #topHUD {
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 30px;
        }

        #lives {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .life {
            width: 30px;
            height: 30px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="%23FF6B6B" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>');
            background-size: contain;
        }

        #menu {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(45,48,71,0.95);
            padding: 30px 50px;
            border-radius: 25px;
            border: 3px solid var(--light-text);
            box-shadow: 0 0 25px rgba(255,230,109,0.4);
            z-index: 100;
        }

        .menu-title {
            font-size: 2.5em;
            color: var(--light-text);
            margin: 0 0 20px 0;
        }

        .btn {
            padding: 15px 30px;
            font-size: 1.2em;
            background: linear-gradient(45deg, var(--main-color), var(--accent-color));
            border: none;
            color: white;
            border-radius: 10px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s;
        }

        .crosshair {
            position: absolute;
            width: 40px;
            height: 40px;
            pointer-events: none;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="none" stroke="%234ECDC4" stroke-width="4"/><path d="M50 20V50M50 80V50M20 50H50M80 50H50" stroke="%23FF6B6B" stroke-width="4"/></svg>');
            background-size: contain;
            filter: drop-shadow(0 0 5px rgba(78,205,196,0.7));
        }

        .particle {
            position: absolute;
            background: var(--light-text);
            border-radius: 50%;
            pointer-events: none;
        }

        .tree {
            position: absolute;
            bottom: 0;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="menu">
        <h1 class="menu-title">üêÆ –ö–æ—Å–º–∏—á–µ—Å–∫–∏–µ –ö–æ—Ä–æ–≤—ã üöÄ</h1>
        <div class="hud" style="margin-bottom: 20px;">–†–µ–∫–æ—Ä–¥: <span id="highScore">0</span></div>
        <button class="btn" id="startBtn">–ò–≥—Ä–∞—Ç—å</button>
        <button class="btn" id="howToBtn">–ü—Ä–∞–≤–∏–ª–∞</button>
        <button class="btn" id="leaderboardBtn">–¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤</button>
    </div>

    <div id="topHUD" class="hud">
        <div>–û—á–∫–∏: <span id="score">0</span></div>
        <div id="lives"></div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('score');
        const livesElement = document.getElementById('lives');
        const highScoreElement = document.getElementById('highScore');

        let gameState = {
            targets: [],
            score: 0,
            lives: 3,
            isPlaying: false,
            crosshair: { x: 0, y: 0 },
            lastSpawn: 0,
            gameTime: 60000,
            particles: [],
            trees: [],
            cowTypes: [
                { speed: 2, color: '#FF6B6B', health: 1, score: 100, radius: 25 },
                { speed: 3, color: '#4ECDC4', health: 2, score: 200, radius: 30 },
                { speed: 4, color: '#FFE66D', health: 3, score: 300, radius: 35 }
            ],
            leaderboard: JSON.parse(localStorage.getItem('leaderboard')) || []
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function initGame() {
            resizeCanvas();
            generateTrees();
            updateLivesDisplay();
            highScoreElement.textContent = Math.max(...gameState.leaderboard, 0);
        }

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        function generateTrees() {
            gameState.trees = [];
            for(let i = 0; i < 8; i++) {
                gameState.trees.push({
                    x: Math.random() * canvas.width,
                    height: 100 + Math.random() * 100,
                    crownSize: 60 + Math.random() * 40
                });
            }
        }

        function drawEnvironment() {
            // –†–∏—Å—É–µ–º –∑–µ–º–ª—é
            ctx.fillStyle = '#2d5a27';
            ctx.fillRect(0, canvas.height - 100, canvas.width, 100);

            // –†–∏—Å—É–µ–º –¥–µ—Ä–µ–≤—å—è
            gameState.trees.forEach(tree => {
                ctx.fillStyle = '#3d2b1f';
                ctx.fillRect(tree.x - 10, canvas.height - tree.height, 20, tree.height - 20);
                
                ctx.beginPath();
                ctx.arc(tree.x, canvas.height - tree.height - 20, tree.crownSize, 0, Math.PI * 2);
                ctx.fillStyle = '#1a3f1a';
                ctx.fill();
            });
        }

        function createCow() {
            const type = Math.floor(Math.random() * gameState.cowTypes.length);
            return {
                x: Math.random() < 0.5 ? -100 : canvas.width + 100,
                y: Math.random() * (canvas.height * 0.6),
                type: type,
                health: gameState.cowTypes[type].health,
                speed: gameState.cowTypes[type].speed,
                direction: Math.random() < 0.5 ? 1 : -1,
                width: 60,
                height: 60
            };
        }

        function drawCow(cow) {
            const type = gameState.cowTypes[cow.type];
            
            // –¢–µ–ª–æ
            ctx.fillStyle = type.color;
            ctx.beginPath();
            ctx.ellipse(
                cow.x + 30, 
                cow.y + 30, 
                type.radius, 
                type.radius * 0.8, 
                Math.PI/4 * cow.direction, 
                0, 
                Math.PI * 2
            );
            ctx.fill();

            // –ó–¥–æ—Ä–æ–≤—å–µ
            ctx.fillStyle = 'white';
            ctx.font = '14px Rubik';
            ctx.fillText('‚ù§'.repeat(cow.health), cow.x + 15, cow.y - 10);
        }

        function createParticles(x, y) {
            for(let i = 0; i < 15; i++) {
                gameState.particles.push({
                    x: x,
                    y: y,
                    size: 3 + Math.random() * 5,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10,
                    alpha: 1
                });
            }
        }

        function checkCollision(cow) {
            const type = gameState.cowTypes[cow.type];
            const dx = gameState.crosshair.x - (cow.x + 30);
            const dy = gameState.crosshair.y - (cow.y + 30);
            return Math.hypot(dx, dy) < type.radius;
        }

        function updateLeaderboard() {
            gameState.leaderboard.push(gameState.score);
            gameState.leaderboard.sort((a,b) => b - a);
            gameState.leaderboard = gameState.leaderboard.slice(0, 10);
            localStorage.setItem('leaderboard', JSON.stringify(gameState.leaderboard));
        }

        function showLeaderboard() {
            const list = gameState.leaderboard.map((score, i) => 
                `${i+1}. ${score}`).join('\n');
            alert(`üèÜ –¢–æ–ø 10 —Ä–µ–∫–æ—Ä–¥–æ–≤:\n${list}`);
        }

        function gameLoop(timestamp) {
            if (!gameState.isPlaying) return;

            // –°–ø–∞–≤–Ω –∫–æ—Ä–æ–≤
            if (timestamp - gameState.lastSpawn > 2000 && gameState.targets.length < 5) {
                gameState.targets.push(createCow());
                gameState.lastSpawn = timestamp;
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ—Ä–æ–≤
            gameState.targets = gameState.targets.filter(cow => {
                cow.x += cow.speed * cow.direction;
                
                if ((cow.direction === 1 && cow.x > canvas.width + 150) ||
                    (cow.direction === -1 && cow.x < -150)) {
                    gameState.lives--;
                    updateLivesDisplay();
                    if(gameState.lives <= 0) endGame();
                    return false;
                }
                return true;
            });

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–∞—Å—Ç–∏—Ü
            gameState.particles = gameState.particles.filter(p => {
                p.x += p.vx;
                p.y += p.vy;
                p.alpha -= 0.03;
                return p.alpha > 0;
            });

            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawEnvironment();
            
            gameState.targets.forEach(drawCow);
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —á–∞—Å—Ç–∏—Ü
            gameState.particles.forEach(p => {
                ctx.fillStyle = `rgba(255,230,109,${p.alpha})`;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();
            });

            requestAnimationFrame(gameLoop);
        }

        function handleShoot() {
            if (!gameState.isPlaying) return;

            createParticles(gameState.crosshair.x, gameState.crosshair.y);
            let hit = false;

            gameState.targets.forEach(cow => {
                if (checkCollision(cow)) {
                    cow.health--;
                    hit = true;
                    if(cow.health <= 0) {
                        gameState.score += gameState.cowTypes[cow.type].score;
                        cow.dead = true;
                    }
                }
            });

            gameState.targets = gameState.targets.filter(cow => !cow.dead);
            scoreElement.textContent = gameState.score;
        }

        function endGame() {
            gameState.isPlaying = false;
            updateLeaderboard();
            document.getElementById('menu').style.display = 'block';
            alert(`–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –í–∞—à —Å—á–µ—Ç: ${gameState.score}`);
        }

        // –°–æ–±—ã—Ç–∏—è
        document.getElementById('startBtn').addEventListener('click', () => {
            document.getElementById('menu').style.display = 'none';
            gameState = {
                ...gameState,
                targets: [],
                score: 0,
                lives: 3,
                isPlaying: true,
                lastSpawn: 0
            };
            updateLivesDisplay();
            setTimeout(endGame, gameState.gameTime);
            requestAnimationFrame(gameLoop);
        });

        document.getElementById('howToBtn').addEventListener('click', () => {
            alert(`üéØ –ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã:
1. –°—Ç—Ä–µ–ª—è–π—Ç–µ –≤ –ª–µ—Ç–∞—é—â–∏—Ö –∫–æ—Ä–æ–≤
2. –†–∞–∑–Ω—ã–µ –∫–æ—Ä–æ–≤—ã —Ç—Ä–µ–±—É—é—Ç —Ä–∞–∑–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–ø–∞–¥–∞–Ω–∏–π
3. –£ –≤–∞—Å 3 –∂–∏–∑–Ω–∏
4. –°–æ–±–∏—Ä–∞–π—Ç–µ –±–æ–ª—å—à–µ –æ—á–∫–æ–≤
5. –ò–≥—Ä–∞ –¥–ª–∏—Ç—Å—è 60 —Å–µ–∫—É–Ω–¥!`);
        });

        document.getElementById('leaderboardBtn').addEventListener('click', showLeaderboard);

        canvas.addEventListener('mousedown', handleShoot);
        canvas.addEventListener('touchstart', handleShoot);

        window.addEventListener('resize', initGame);
        initGame();
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
    </script>
</body>
</html>