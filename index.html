<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mad Cow Hunt</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --main-color: #FF6B6B;
            --secondary-color: #4ECDC4;
            --dark-color: #2D3436;
        }

        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            touch-action: none;
            font-family: 'Luckiest Guy', cursive;
            background: var(--dark-color);
            color: white;
        }

        #gameCanvas {
            position: relative;
            background: linear-gradient(180deg, #87CEEB 60%, #75B08A 100%);
        }

        /* Main Menu Styles */
        #mainMenu {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            background: rgba(45, 52, 54, 0.95);
            padding: 2rem;
            border-radius: 20px;
            border: 3px solid var(--main-color);
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        .menu-title {
            font-size: 3rem;
            color: var(--main-color);
            margin: 0 0 2rem 0;
            text-shadow: 3px 3px 0 var(--dark-color);
        }

        .menu-btn {
            display: block;
            width: 200px;
            padding: 1rem;
            margin: 1rem auto;
            font-size: 1.2rem;
            background: var(--secondary-color);
            border: none;
            border-radius: 15px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .menu-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px var(--secondary-color);
        }

        /* In-Game HUD */
        #topHUD {
            position: absolute;
            top: 10px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            font-size: 1.5rem;
        }

        #bottomHUD {
            position: absolute;
            bottom: 10px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            padding: 0 20px;
        }

        .ammo-counter {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #pistolImg {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 120px;
        }

        .crosshair {
            position: absolute;
            width: 32px;
            height: 32px;
            pointer-events: none;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path fill="%23FF6B6B" d="M16 2C8.3 2 2 8.3 2 16s6.3 14 14 14 14-6.3 14-14S23.7 2 16 2zm0 24c-5.5 0-10-4.5-10-10S10.5 6 16 6s10 4.5 10 10-4.5 10-10 10z"/><path fill="%23FF6B6B" d="M16 10l-4 4h3v4h2v-4h3z"/></svg>');
            background-size: contain;
        }

        .life-heart {
            width: 30px;
            height: 30px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="%23FF6B6B" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>');
        }
    </style>
</head>
<body>
    <div id="mainMenu">
        <h1 class="menu-title">MAD COW HUNT</h1>
        <button class="menu-btn" id="startBtn">START GAME</button>
        <button class="menu-btn" id="howToBtn">HOW TO PLAY</button>
        <button class="menu-btn" id="highScoreBtn">HIGH SCORES</button>
    </div>

    <canvas id="gameCanvas"></canvas>
    <div id="topHUD">
        <div>SCORE: <span id="score">0</span></div>
        <div>LIVES: <span id="lives"></span></div>
    </div>
    <div id="bottomHUD">
        <div class="ammo-counter">
            <span>AMMO: <span id="ammo">10</span></span>
            <span>HITS: <span id="hits">0</span></span>
            <span>MISS: <span id="miss">0</span></span>
        </div>
        <button id="pauseBtn" style="display: none;">PAUSE</button>
    </div>
    <img id="pistolImg" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGZpbGw9IiM2RjcyNzkiIGQ9Ik03NjggNjQwSDMyMHYtNjRoNDQ4di02NEgyNTZWMjU2aDU3NnYzMjB6Ii8+PHBhdGggZmlsbD0iI0ZGRiIgZD0iTTc2OCA1MTJIMzIwdjY0aDQ0OHY2NEgyNTZ2LTM4NGg1NzZ2MjU2eiIvPjwvc3ZnPg==" alt="Pistol">
    <div class="crosshair"></div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const mainMenu = document.getElementById('mainMenu');
        const crosshair = document.querySelector('.crosshair');
        
        // Game state
        let gameState = {
            score: 0,
            ammo: 10,
            lives: 3,
            hits: 0,
            miss: 0,
            isPlaying: false,
            isPaused: false,
            reloading: false,
            cows: [],
            trees: [],
            particles: [],
            lastShot: 0,
            fireRate: 300,
            highScores: JSON.parse(localStorage.getItem('highScores')) || []
        };

        // Resize handler
        function resizeCanvas() {
            canvas.width = Math.min(window.innerWidth, 800);
            canvas.height = Math.min(window.innerHeight, 600);
            generateTrees();
        }
        
        // Generate trees
        function generateTrees() {
            gameState.trees = [];
            for(let i = 0; i < 8; i++) {
                gameState.trees.push({
                    x: Math.random() * canvas.width,
                    width: 40 + Math.random() * 40,
                    height: 80 + Math.random() * 40
                });
            }
        }

        // Cow types
        const cowTypes = [
            { color: '#F0F0F0', speed: 2, pattern: 'linear', score: 20 },
            { color: '#B8860B', speed: 3, pattern: 'sinus', score: 30 },
            { color: '#8B0000', speed: 4, pattern: 'zigzag', score: 50 }
        ];

        // Create new cow
        function createCow() {
            if(gameState.cows.length >= 4) return;
            
            const type = cowTypes[Math.floor(Math.random() * cowTypes.length)];
            return {
                x: -100,
                y: Math.random() * (canvas.height * 0.6),
                type: type,
                width: 60,
                height: 40,
                angle: 0,
                frame: 0,
                hit: false,
                hidden: false
            };
        }

        // Draw functions
        function drawTree(x, width, height) {
            // Trunk
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(x - width/4, canvas.height - height, width/2, height);
            
            // Leaves
            ctx.beginPath();
            ctx.arc(x, canvas.height - height - 30, width, 0, Math.PI * 2);
            ctx.fillStyle = '#228B22';
            ctx.fill();
        }

        function drawCow(cow) {
            if(cow.hidden) return;
            
            ctx.save();
            ctx.translate(cow.x, cow.y);
            
            // Body
            ctx.fillStyle = cow.type.color;
            ctx.fillRect(-30, -20, 60, 40);
            
            // Head
            ctx.beginPath();
            ctx.arc(25, -5, 15, 0, Math.PI * 2);
            ctx.fill();
            
            // Horns
            ctx.strokeStyle = '#8B4513';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(30, -15);
            ctx.lineTo(40, -25);
            ctx.moveTo(30, -10);
            ctx.lineTo(40, -5);
            ctx.stroke();
            
            // Wings
            ctx.strokeStyle = 'rgba(255,255,255,0.8)';
            ctx.beginPath();
            ctx.arc(-25, 0, 20, Math.PI/2 + cow.angle, Math.PI*1.5 - cow.angle);
            ctx.stroke();
            
            ctx.restore();
        }

        // Game loop
        function gameLoop(timestamp) {
            if(!gameState.isPlaying || gameState.isPaused) return;

            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw ground
            ctx.fillStyle = '#556B2F';
            ctx.fillRect(0, canvas.height - 60, canvas.width, 60);

            // Draw trees
            gameState.trees.forEach(tree => drawTree(tree.x, tree.width, tree.height));

            // Update cows
            gameState.cows = gameState.cows.filter(cow => {
                // Movement patterns
                switch(cow.type.pattern) {
                    case 'sinus':
                        cow.x += cow.type.speed;
                        cow.y += Math.sin(cow.frame * 0.1) * 2;
                        break;
                    case 'zigzag':
                        cow.x += cow.type.speed;
                        cow.y += (cow.frame % 30 < 15) ? 1 : -1;
                        break;
                    default:
                        cow.x += cow.type.speed;
                }
                
                cow.frame++;
                cow.angle = Math.sin(timestamp * 0.01) * 0.3;
                cow.hidden = gameState.trees.some(tree => 
                    cow.x > tree.x - tree.width/2 && 
                    cow.x < tree.x + tree.width/2 &&
                    cow.y > canvas.height - tree.height - 40
                );

                return cow.x < canvas.width + 100 && !cow.hit;
            });

            // Spawn new cows
            if(gameState.cows.length < 4 && Math.random() < 0.02) {
                gameState.cows.push(createCow());
            }

            // Draw cows
            gameState.cows.forEach(drawCow);

            // Update HUD
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('ammo').textContent = gameState.ammo;
            document.getElementById('lives').textContent = '❤️'.repeat(gameState.lives);
            document.getElementById('hits').textContent = gameState.hits;
            document.getElementById('miss').textContent = gameState.miss;

            requestAnimationFrame(gameLoop);
        }

        // Event listeners
        canvas.addEventListener('mousedown', handleShoot);
        canvas.addEventListener('touchstart', handleShoot);
        
        document.getElementById('startBtn').addEventListener('click', startGame);
        document.getElementById('pauseBtn').addEventListener('click', togglePause);
        document.getElementById('howToBtn').addEventListener('click', () => {
            alert(`HOW TO PLAY:
- Shoot flying cows with your crosshair
- You have 3 lives and 10 bullets
- Different cow types give different scores
- Cows can hide behind trees
- Game ends when you lose all lives
- Reload by waiting 2 seconds`);
        });
        
        document.getElementById('highScoreBtn').addEventListener('click', () => {
            const scores = gameState.highScores.sort((a,b) => b - a).slice(0, 5);
            alert('HIGH SCORES:\n' + scores.join('\n'));
        });

        // Game functions
        function handleShoot(e) {
            if(!gameState.isPlaying || gameState.reloading || Date.now() - gameState.lastShot < gameState.fireRate) return;

            gameState.ammo--;
            gameState.lastShot = Date.now();
            
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX || e.touches[0].clientX) - rect.left;
            const y = (e.clientY || e.touches[0].clientY) - rect.top;

            let hit = false;
            gameState.cows.forEach(cow => {
                if(!cow.hidden && x > cow.x - 30 && x < cow.x + 30 && 
                   y > cow.y - 20 && y < cow.y + 20) {
                    gameState.score += cow.type.score;
                    gameState.hits++;
                    cow.hit = true;
                    hit = true;
                }
            });

            if(!hit) {
                gameState.miss++;
                if(gameState.miss % 3 === 0) gameState.lives--;
            }

            if(gameState.ammo <= 0) {
                gameState.reloading = true;
                setTimeout(() => {
                    gameState.ammo = 10;
                    gameState.reloading = false;
                }, 2000);
            }

            if(gameState.lives <= 0) endGame();
        }

        function startGame() {
            mainMenu.style.display = 'none';
            document.getElementById('pauseBtn').style.display = 'block';
            gameState = {
                ...gameState,
                score: 0,
                ammo: 10,
                lives: 3,
                hits: 0,
                miss: 0,
                isPlaying: true,
                cows: []
            };
            resizeCanvas();
            gameLoop();
        }

        function togglePause() {
            gameState.isPaused = !gameState.isPaused;
            if(!gameState.isPaused) gameLoop();
        }

        function endGame() {
            gameState.isPlaying = false;
            gameState.highScores.push(gameState.score);
            localStorage.setItem('highScores', JSON.stringify(gameState.highScores));
            mainMenu.style.display = 'block';
            document.getElementById('pauseBtn').style.display = 'none';
            alert(`GAME OVER! Score: ${gameState.score}`);
        }

        // Init
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
    </script>
</body>
</html>