<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chaos Arena</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
            color: #00ffcc;
            font-family: 'Courier New', Courier, monospace;
            min-height: 100vh;
        }

        #menu {
            text-align: center;
            padding-top: 20vh;
        }

        .neon-btn {
            background: linear-gradient(135deg, #00ffcc 0%, #00ccff 100%);
            border: 2px solid #00ffcc;
            color: #000;
            padding: 15px 30px;
            margin: 15px;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 5px;
            box-shadow: 0 0 10px #00ffcc;
        }

        .neon-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px #00ccff;
        }

        #battle-screen {
            display: none;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .status-panel {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin: 20px 0;
        }

        .entity {
            width: 100px;
            height: 100px;
            position: relative;
            transition: transform 0.2s;
        }

        #player {
            background: linear-gradient(135deg, #00ffcc 0%, #00ccff 100%);
            left: 20%;
        }

        #bot {
            background: linear-gradient(135deg, #ff0066 0%, #cc0066 100%);
            right: 20%;
        }

        .health-bar {
            background: #ff0066;
            height: 10px;
            margin-top: 5px;
            position: relative;
        }

        .health-bar div {
            background: #00ffcc;
            height: 100%;
            width: 100%;
            transition: width 0.3s;
        }

        #battle-log {
            height: 150px;
            overflow-y: auto;
            border: 1px solid #00ffcc;
            padding: 10px;
            margin: 20px;
            background: rgba(0, 255, 204, 0.1);
        }

        #upgrade-screen {
            display: none;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .upgrade-btn {
            background: linear-gradient(135deg, #00ccff 0%, #0066ff 100%);
            margin: 10px;
            padding: 15px;
            width: 200px;
            border: none;
            color: white;
            font-size: 1.1em;
            cursor: pointer;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 600px) {
            .status-panel {
                flex-direction: column;
                align-items: center;
            }
            
            #player, #bot {
                left: 10%;
                right: 10%;
            }
        }
    </style>
</head>
<body>
    <div id="menu">
        <h1>CHAOS ARENA</h1>
        <button class="neon-btn" onclick="startBattle()">НАЧАТЬ БОЙ</button>
        <button class="neon-btn" onclick="showUpgrades()">ПРОКАЧКА</button>
        <button class="neon-btn" onclick="window.Telegram.WebApp.close()">ВЫХОД</button>
    </div>

    <div id="battle-screen" class="hidden">
        <div class="status-panel">
            <div>
                <h2>ИГРОК</h2>
                <div>Lv. <span id="player-lvl">1</span></div>
                <div>Атака: <span id="player-atk">10</span></div>
                <div>Броня: <span id="player-def">5</span></div>
                <div class="health-bar"><div id="player-health-bar"></div></div>
            </div>
            <div>
                <h2>БОТ</h2>
                <div>Lv. <span id="bot-lvl">1</span></div>
                <div>Атака: <span id="bot-atk">8</span></div>
                <div>Броня: <span id="bot-def">3</span></div>
                <div class="health-bar"><div id="bot-health-bar"></div></div>
            </div>
        </div>
        
        <div id="arena">
            <div class="entity" id="player"></div>
            <div class="entity" id="bot"></div>
        </div>
        
        <div id="battle-log"></div>
    </div>

    <div id="upgrade-screen" class="hidden">
        <h2>ПРОКАЧКА (очки: <span id="upgrade-points">0</span>)</h2>
        <button class="upgrade-btn" onclick="upgradeStat('atk')">АТАКА (+1)</button>
        <button class="upgrade-btn" onclick="upgradeStat('def')">БРОНЯ (+1)</button>
        <button class="upgrade-btn" onclick="upgradeStat('maxHealth')">ЗДОРОВЬЕ (+10)</button>
    </div>

    <script>
        let player = {
            level: 1,
            exp: 0,
            atk: 10,
            def: 5,
            maxHealth: 100,
            currentHealth: 100,
            upgradePoints: 0
        };

        let bot = {
            level: 1,
            atk: 8,
            def: 3,
            maxHealth: 80,
            currentHealth: 80
        };

        let battleInterval;
        let battleLog = [];
        const expPerLevel = 50;

        function startBattle() {
            document.getElementById('menu').classList.add('hidden');
            document.getElementById('battle-screen').classList.remove('hidden');
            
            resetEntities();
            updateUI();
            bot.currentHealth = bot.maxHealth;
            
            battleLog = [];
            logBattle("Бой начался!");
            
            battleInterval = setInterval(() => {
                playerAttack();
                if(bot.currentHealth <= 0) {
                    clearInterval(battleInterval);
                    endBattle(true);
                    return;
                }
                
                setTimeout(botAttack, 500);
                if(player.currentHealth <= 0) {
                    clearInterval(battleInterval);
                    endBattle(false);
                }
            }, 1000);
        }

        function playerAttack() {
            const damage = Math.max(player.atk - bot.def, 1);
            bot.currentHealth = Math.max(bot.currentHealth - damage, 0);
            
            animateAttack('player');
            logBattle(`Игрок наносит ${damage} урона!`);
            updateUI();
        }

        function botAttack() {
            const damage = Math.max(bot.atk - player.def, 1);
            player.currentHealth = Math.max(player.currentHealth - damage, 0);
            
            animateAttack('bot');
            logBattle(`Бот наносит ${damage} урона!`);
            updateUI();
        }

        function animateAttack(entity) {
            const elem = document.getElementById(entity);
            elem.style.transform = 'scale(1.2)';
            setTimeout(() => elem.style.transform = 'scale(1)', 200);
        }

        function endBattle(victory) {
            if(victory) {
                const expGained = Math.floor(Math.random() * 20 + 10);
                player.exp += expGained;
                logBattle(`Победа! Получено ${expGained} опыта.`);
                
                if(player.exp >= expPerLevel) {
                    player.level++;
                    player.upgradePoints++;
                    player.exp = 0;
                    showUpgrades();
                }
            } else {
                logBattle("Поражение...");
                setTimeout(resetGame, 2000);
            }
        }

        function resetGame() {
            player.currentHealth = player.maxHealth;
            document.getElementById('battle-screen').classList.add('hidden');
            document.getElementById('menu').classList.remove('hidden');
        }

        function showUpgrades() {
            clearInterval(battleInterval);
            document.getElementById('battle-screen').classList.add('hidden');
            document.getElementById('upgrade-screen').classList.remove('hidden');
            document.getElementById('upgrade-points').textContent = player.upgradePoints;
        }

        function upgradeStat(stat) {
            if(player.upgradePoints > 0) {
                player.upgradePoints--;
                switch(stat) {
                    case 'atk':
                        player.atk += 1;
                        break;
                    case 'def':
                        player.def += 1;
                        break;
                    case 'maxHealth':
                        player.maxHealth += 10;
                        player.currentHealth += 10;
                        break;
                }
                document.getElementById('upgrade-points').textContent = player.upgradePoints;
                updateUI();
                
                if(player.upgradePoints === 0) {
                    document.getElementById('upgrade-screen').classList.add('hidden');
                    document.getElementById('menu').classList.remove('hidden');
                }
            }
        }

        function updateUI() {
            // Player stats
            document.getElementById('player-lvl').textContent = player.level;
            document.getElementById('player-atk').textContent = player.atk;
            document.getElementById('player-def').textContent = player.def;
            document.getElementById('player-health-bar').style.width = 
                (player.currentHealth / player.maxHealth) * 100 + '%';
            
            // Bot stats
            document.getElementById('bot-lvl').textContent = bot.level;
            document.getElementById('bot-atk').textContent = bot.atk;
            document.getElementById('bot-def').textContent = bot.def;
            document.getElementById('bot-health-bar').style.width = 
                (bot.currentHealth / bot.maxHealth) * 100 + '%';
        }

        function logBattle(message) {
            battleLog.push(message);
            const logElement = document.getElementById('battle-log');
            logElement.innerHTML = battleLog.map(msg => `<div>${msg}</div>`).join('');
            logElement.scrollTop = logElement.scrollHeight;
        }

        function resetEntities() {
            player.currentHealth = player.maxHealth;
            bot.currentHealth = bot.maxHealth;
            updateUI();
        }

        // Telegram Web App initialization
        if(window.Telegram) {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
        }
    </script>
</body>
</html>
