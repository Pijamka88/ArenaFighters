<!DOCTYPE html>
<html>
<head>
    <title>Cat Arena</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #1a1a1a;
            color: #e0e0e0;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
        }
        #mainMenu {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        .menuButton {
            background: #330066;
            border: 2px solid #4d008c;
            padding: 15px 30px;
            margin: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: 0.3s;
            font-size: 18px;
        }
        .menuButton:hover {
            background: #4d008c;
        }
        #gameContainer {
            display: none;
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        .fighter {
            position: absolute;
            width: 100px;
            height: 100px;
            transition: 0.2s;
        }
        #player {
            bottom: 50px;
            left: 50px;
            background: #66ff66;
        }
        #enemy {
            top: 50px;
            right: 50px;
            background: #ff6666;
        }
        #battleLog {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            height: 100px;
            overflow-y: auto;
            border: 2px solid #444;
            padding: 10px;
            background: rgba(0,0,0,0.7);
        }
        #levelUpScreen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
        }
        .statButton {
            background: #663399;
            border: 2px solid #7d3cb3;
            padding: 10px;
            margin: 10px;
            width: 200px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .statButton:disabled {
            background: #444;
            border-color: #555;
            cursor: not-allowed;
        }
        .hidden { display: none; }
        .pulse {
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div id="mainMenu">
        <h1>CAT ARENA</h1>
        <div class="menuButton" onclick="startGame()">НАЧАТЬ БОЙ</div>
        <div class="menuButton" onclick="showLevelUpScreen()">ПРОКАЧКА</div>
    </div>

    <div id="gameContainer" class="hidden">
        <div id="player" class="fighter"></div>
        <div id="enemy" class="fighter"></div>
        <div id="battleLog"></div>
        <div id="playerStats"></div>
        <div id="enemyStats"></div>
    </div>

    <div id="levelUpScreen" class="hidden">
        <h2>ПРОКАЧКА (Очков: <span id="skillPoints">0</span>)</h2>
        <div class="statButton" onclick="upgradeStat('health')">Здоровье (+10)</div>
        <div class="statButton" onclick="upgradeStat('energy')">Энергия (+5)</div>
        <div class="statButton" onclick="upgradeStat('armor')">Броня (+2)</div>
        <div class="menuButton" onclick="toggleMainMenu()">НАЗАД</div>
    </div>

<script>
const gameState = {
    player: {
        level: 1,
        xp: 0,
        skillPoints: 0,
        health: 100,
        maxHealth: 100,
        energy: 50,
        maxEnergy: 50,
        armor: 5,
        attackPower: 15
    },
    enemy: {
        level: 1,
        health: 100,
        maxHealth: 100,
        armor: 3,
        attackPower: 12
    },
    battleInProgress: false
};

function startGame() {
    document.getElementById('mainMenu').classList.add('hidden');
    document.getElementById('gameContainer').classList.remove('hidden');
    
    if (!gameState.battleInProgress) {
        initBattle();
    }
}

function initBattle() {
    gameState.battleInProgress = true;
    generateEnemy();
    updateStatsDisplay();
    battleLog("Бой начинается!");
    gameLoop();
}

function generateEnemy() {
    const level = gameState.player.level;
    gameState.enemy = {
        level: level,
        health: 80 + level * 20,
        maxHealth: 80 + level * 20,
        armor: 2 + Math.floor(level/2),
        attackPower: 10 + level * 2
    };
}

function gameLoop() {
    if (!gameState.battleInProgress) return;

    // Player attack
    if (Math.random() < 0.5) {
        playerAttack();
    }
    
    // Enemy attack
    setTimeout(() => {
        enemyAttack();
        setTimeout(gameLoop, 1000);
    }, 500);
}

function playerAttack() {
    const damage = calculateDamage(gameState.player.attackPower, gameState.enemy.armor);
    gameState.enemy.health -= damage;
    updateStatsDisplay();
    animateAttack('player');
    battleLog(`Вы наносите ${damage} урона!`);
    checkBattleEnd();
}

function enemyAttack() {
    const damage = calculateDamage(gameState.enemy.attackPower, gameState.player.armor);
    gameState.player.health -= damage;
    updateStatsDisplay();
    animateAttack('enemy');
    battleLog(`Враг наносит ${damage} урона!`);
    checkBattleEnd();
}

function calculateDamage(attack, armor) {
    return Math.max(5, Math.floor(attack * (1 - armor/100)));
}

function checkBattleEnd() {
    if (gameState.enemy.health <= 0) {
        endBattle(true);
    } else if (gameState.player.health <= 0) {
        endBattle(false);
    }
}

function endBattle(victory) {
    gameState.battleInProgress = false;
    if (victory) {
        const xpGain = 50 + gameState.enemy.level * 10;
        gameState.player.xp += xpGain;
        battleLog(`Победа! +${xpGain} опыта`);
        checkLevelUp();
    } else {
        battleLog("Поражение!");
    }
    setTimeout(resetGame, 2000);
}

function checkLevelUp() {
    const xpNeeded = gameState.player.level * 100;
    if (gameState.player.xp >= xpNeeded) {
        gameState.player.level++;
        gameState.player.skillPoints++;
        gameState.player.xp -= xpNeeded;
        battleLog("Новый уровень! У вас " + gameState.player.skillPoints + " очков прокачки");
    }
}

function resetGame() {
    gameState.player.health = gameState.player.maxHealth;
    gameState.player.energy = gameState.player.maxEnergy;
    document.getElementById('gameContainer').classList.add('hidden');
    document.getElementById('mainMenu').classList.remove('hidden');
    updateStatsDisplay();
}

function showLevelUpScreen() {
    document.getElementById('mainMenu').classList.add('hidden');
    document.getElementById('levelUpScreen').classList.remove('hidden');
    updateLevelUpScreen();
}

function updateLevelUpScreen() {
    document.getElementById('skillPoints').textContent = gameState.player.skillPoints;
    document.querySelectorAll('.statButton').forEach(btn => {
        btn.disabled = gameState.player.skillPoints <= 0;
    });
}

function upgradeStat(stat) {
    if (gameState.player.skillPoints <= 0) return;
    
    gameState.player.skillPoints--;
    switch(stat) {
        case 'health':
            gameState.player.maxHealth += 10;
            gameState.player.health += 10;
            break;
        case 'energy':
            gameState.player.maxEnergy += 5;
            gameState.player.energy += 5;
            break;
        case 'armor':
            gameState.player.armor += 2;
            break;
    }
    updateLevelUpScreen();
    updateStatsDisplay();
}

function toggleMainMenu() {
    document.getElementById('levelUpScreen').classList.add('hidden');
    document.getElementById('mainMenu').classList.remove('hidden');
}

function updateStatsDisplay() {
    document.getElementById('playerStats').innerHTML = `
        Ур: ${gameState.player.level} | HP: ${gameState.player.health}/${gameState.player.maxHealth} 
        | Эн: ${gameState.player.energy}/${gameState.player.maxEnergy} 
        | Броня: ${gameState.player.armor}
    `;
    document.getElementById('enemyStats').innerHTML = `
        Враг Ур: ${gameState.enemy.level} | HP: ${gameState.enemy.health}/${gameState.enemy.maxHealth}
    `;
}

function battleLog(message) {
    const log = document.getElementById('battleLog');
    log.innerHTML += `<div>${message}</div>`;
    log.scrollTop = log.scrollHeight;
}

function animateAttack(attacker) {
    const element = document.getElementById(attacker);
    element.classList.add('pulse');
    setTimeout(() => element.classList.remove('pulse'), 500);
}
</script>
</body>
</html>
