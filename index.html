<!DOCTYPE html>
<html>
<head>
    <title>Darkstone Arena</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            --bg-dark: #1a1a1a;
            --bg-light: #2d2d2d;
            --accent-red: #c62828;
            --accent-gold: #d4af37;
            --text-primary: #e0e0e0;
            --text-secondary: #9e9e9e;
        }

        body {
            margin: 0;
            background: var(--bg-dark);
            color: var(--text-primary);
            font-family: 'Arial', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            padding: 2rem;
            background: var(--bg-light);
            border-bottom: 3px solid var(--accent-gold);
        }

        .combat-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin: 2rem 0;
        }

        .character-card {
            background: var(--bg-light);
            border-radius: 8px;
            padding: 1.5rem;
            position: relative;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .health-bar {
            height: 24px;
            background: #4a2b0f;
            border-radius: 12px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .health-fill {
            height: 100%;
            background: linear-gradient(45deg, #50C878, #3E8C47);
            transition: width 0.3s ease;
        }

        .stats-panel {
            background: rgba(0,0,0,0.3);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .button {
            background: var(--accent-gold);
            color: var(--bg-dark);
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
            margin: 0.5rem;
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .battle-log {
            height: 200px;
            overflow-y: auto;
            background: rgba(0,0,0,0.2);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-light);
            padding: 2rem;
            border-radius: 8px;
            z-index: 1000;
            max-width: 400px;
        }

        .skill-tree {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }

        .skill-node {
            background: var(--bg-dark);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .skill-node.unlocked {
            background: var(--accent-gold);
            color: var(--bg-dark);
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Darkstone Arena</h1>
        <div class="button-group">
            <button class="button" onclick="startNewGame()">New Game</button>
            <button class="button" onclick="showSkillTree()">Skill Tree</button>
        </div>
    </div>

    <div class="container">
        <div class="combat-container">
            <div class="character-card">
                <h2>Player</h2>
                <div class="health-bar">
                    <div id="playerHealth" class="health-fill" style="width: 100%"></div>
                </div>
                <div class="stats-panel">
                    <div>Level: <span id="level">1</span></div>
                    <div>XP: <span id="xp">0/100</span></div>
                    <div>Gold: <span id="gold">0</span></div>
                </div>
            </div>

            <div class="character-card">
                <h2 id="enemyName">Enemy</h2>
                <div class="health-bar">
                    <div id="enemyHealth" class="health-fill" style="width: 100%"></div>
                </div>
                <div class="stats-panel">
                    <div>Streak: <span id="streak">0</span></div>
                    <div>Next Boss: <span id="bossCounter">5</span></div>
                </div>
            </div>
        </div>

        <div class="battle-log" id="battleLog"></div>
        
        <div class="button-group">
            <button class="button" id="attackButton" onclick="startCombat()">Start Combat</button>
            <button class="button" onclick="showShop()">Visit Shop</button>
        </div>
    </div>

    <!-- Skill Tree Modal -->
    <div id="skillModal" class="modal hidden">
        <h3>Skill Tree</h3>
        <div class="skill-tree" id="skillTree"></div>
        <button class="button" onclick="hideModals()">Close</button>
    </div>

    <!-- Shop Modal -->
    <div id="shopModal" class="modal hidden">
        <h3>Blacksmith</h3>
        <div class="shop-items" id="shopItems"></div>
        <button class="button" onclick="hideModals()">Close</button>
    </div>

    <script>
        const SKILLS = [
            { id: 'crit', name: 'Critical Strike', cost: 3, effect: { critChance: 0.1 } },
            { id: 'block', name: 'Shield Block', cost: 2, effect: { blockChance: 0.15 } },
            { id: 'rage', name: 'Battle Rage', cost: 5, effect: { damageBoost: 0.2 } }
        ];

        const SHOP_ITEMS = [
            { name: 'Health Potion', cost: 50, effect: { health: 50 } },
            { name: 'Attack Boost', cost: 100, effect: { attack: 5 } },
            { name: 'Defense Boost', cost: 75, effect: { defense: 3 } }
        ];

        let player = {
            level: 1,
            xp: 0,
            gold: 0,
            health: 100,
            maxHealth: 100,
            attack: 10,
            defense: 5,
            skills: [],
            inventory: [],
            streak: 0
        };

        let currentEnemy = null;
        let combatInterval = null;

        function createEnemy() {
            const baseHealth = 50 + player.streak * 10;
            const baseAttack = 8 + player.streak * 2;
            
            return {
                name: getEnemyName(),
                health: baseHealth,
                maxHealth: baseHealth,
                attack: baseAttack,
                defense: 2 + player.streak
            };
        }

        function getEnemyName() {
            const names = ['Raider', 'Mercenary', 'Warlock', 'Berserker'];
            return names[Math.floor(Math.random() * names.length)];
        }

        function startCombat() {
            if (player.health <= 0) return;
            
            currentEnemy = createEnemy();
            combatInterval = setInterval(performCombatRound, 1000);
            logMessage('Combat started!');
        }

        function performCombatRound() {
            // Player attack
            let damage = calculateDamage(player, currentEnemy);
            currentEnemy.health -= damage;
            logMessage(`You hit for ${damage} damage!`);

            // Enemy attack
            damage = calculateDamage(currentEnemy, player);
            player.health -= damage;
            logMessage(`Enemy strikes for ${damage} damage!`);

            updateUI();

            if (currentEnemy.health <= 0) {
                endCombat(true);
            } else if (player.health <= 0) {
                endCombat(false);
            }
        }

        function calculateDamage(attacker, defender) {
            const baseDamage = attacker.attack - defender.defense;
            const critChance = attacker.skills.includes('crit') ? 0.1 : 0;
            const isCrit = Math.random() < critChance;
            
            return Math.max(1, isCrit ? baseDamage * 2 : baseDamage);
        }

        function endCombat(victory) {
            clearInterval(combatInterval);
            
            if (victory) {
                player.streak++;
                player.gold += 25;
                player.xp += 10;
                logMessage('Victory! +25 Gold +10 XP');
                
                if (player.xp >= 100) {
                    levelUp();
                }
                
                if (player.streak % 5 === 0) {
                    spawnBoss();
                }
            } else {
                player.streak = 0;
                logMessage('Defeat...');
            }
            
            saveGame();
            updateUI();
        }

        function levelUp() {
            player.level++;
            player.xp = 0;
            player.maxHealth += 20;
            player.health = player.maxHealth;
            logMessage(`Level Up! Reached level ${player.level}`);
        }

        function spawnBoss() {
            currentEnemy = {
                name: 'Dragon Lord',
                health: 300,
                maxHealth: 300,
                attack: 25,
                defense: 15
            };
            logMessage('A mighty boss has appeared!');
        }

        function showSkillTree() {
            const treeContainer = document.getElementById('skillTree');
            treeContainer.innerHTML = SKILLS.map(skill => `
                <div class="skill-node ${player.skills.includes(skill.id) ? 'unlocked' : ''}" 
                     onclick="unlockSkill('${skill.id}')">
                    ${skill.name}<br>
                    Cost: ${skill.cost} points
                </div>
            `).join('');
            document.getElementById('skillModal').classList.remove('hidden');
        }

        function unlockSkill(skillId) {
            const skill = SKILLS.find(s => s.id === skillId);
            if (player.level >= skill.cost && !player.skills.includes(skillId)) {
                player.skills.push(skillId);
                player.level -= skill.cost;
                updateUI();
                showSkillTree();
            }
        }

        function showShop() {
            const shopContainer = document.getElementById('shopItems');
            shopContainer.innerHTML = SHOP_ITEMS.map(item => `
                <div class="shop-item">
                    <button class="button" onclick="buyItem(${SHOP_ITEMS.indexOf(item)})">
                        ${item.name} - ${item.cost} Gold
                    </button>
                </div>
            `).join('');
            document.getElementById('shopModal').classList.remove('hidden');
        }

        function buyItem(index) {
            const item = SHOP_ITEMS[index];
            if (player.gold >= item.cost) {
                player.gold -= item.cost;
                applyItemEffect(item.effect);
                updateUI();
            }
        }

        function applyItemEffect(effect) {
            Object.keys(effect).forEach(key => {
                if (key === 'health') {
                    player.health = Math.min(player.maxHealth, player.health + effect[key]);
                } else {
                    player[key] += effect[key];
                }
            });
        }

        function updateUI() {
            // Player stats
            document.getElementById('level').textContent = player.level;
            document.getElementById('xp').textContent = `${player.xp}/100`;
            document.getElementById('gold').textContent = player.gold;
            
            // Health bars
            document.getElementById('playerHealth').style.width = 
                `${(player.health / player.maxHealth) * 100}%`;
            
            if (currentEnemy) {
                document.getElementById('enemyHealth').style.width = 
                    `${(currentEnemy.health / currentEnemy.maxHealth) * 100}%`;
                document.getElementById('enemyName').textContent = currentEnemy.name;
            }
            
            // Streak info
            document.getElementById('streak').textContent = player.streak;
            document.getElementById('bossCounter').textContent = 5 - (player.streak % 5);
        }

        function logMessage(message) {
            const log = document.getElementById('battleLog');
            const entry = document.createElement('div');
            entry.textContent = message;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        function hideModals() {
            document.querySelectorAll('.modal').forEach(m => m.classList.add('hidden'));
        }

        function saveGame() {
            localStorage.setItem('arenaSave', JSON.stringify(player));
        }

        function loadGame() {
            const saved = localStorage.getItem('arenaSave');
            if (saved) player = JSON.parse(saved);
            updateUI();
        }

        function startNewGame() {
            player = {
                level: 1,
                xp: 0,
                gold: 0,
                health: 100,
                maxHealth: 100,
                attack: 10,
                defense: 5,
                skills: [],
                inventory: [],
                streak: 0
            };
            updateUI();
        }

        // Initialize game
        window.onload = loadGame;
    </script>
</body>
</html>